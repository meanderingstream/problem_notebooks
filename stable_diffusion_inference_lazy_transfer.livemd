# Stable Diffusion using BumbleBee

```elixir
# This should be set appropriately for the system
# eg. cuda118 for a machine with a GPU and CUDA 11.8+
# IO.puts(System.get_env("XLA_TARGET"))

Mix.install(
  [
    # {:bumblebee, github: "elixir-nx/bumblebee", branch: "main", override: true},
    {:bumblebee, "~> 0.1.2"},
    {:exla, "~> 0.4"},
    #  {:exla, github: "elixir-nx/nx", sparse: "exla"}
    {:kino_bumblebee, "~> 0.1.0"}
  ],
  config: [nx: [default_backend: EXLA.Backend]],
  # config: [nx: [default_backend: ]]
  system_env: %{"XLA_TARGET" => "cuda118"}
)

# Nx.global_default_backend(EXLA.Backend)
Nx.global_default_backend({EXLA.Backend, client: :cuda})
# Nx.Defn.global_default_options(compiler: EXLA)
```

<!-- livebook:{"output":true} -->

```
{EXLA.Backend, []}
```

## Original Notebook from https://github.com/hanrelan/BumbleBooth

The major changes I made was to use the new lazy transfer capability.

```elixir
# Nx.default_backend({EXLA.Backend, client: :cuda})
Nx.default_backend({EXLA.Backend, client: :host})
```

<!-- livebook:{"output":true} -->

```
{EXLA.Backend, [client: :cuda]}
```

```elixir
Nx.default_backend()
```

<!-- livebook:{"output":true} -->

```
{EXLA.Backend, [client: :host]}
```

## SD Inference broken down

Now that we know the basics are working (which is a huge step since it means CUDA, XLA and Nx are all set up correctly), we're going to go a little deeper. Right now, a lot of the details of Stable Diffusion are hidden behind the `Bumblebee.Diffusion.StableDiffusion.text_to_image` function. We're going to break this function down into its parts in this notebook so we can start modifying the pieces in the next step.

For this breakdown, we're going to ignore some of the unnecessary/less interesting bits like the safety checker and doing multiple images per prompt.

This breakdown is based on the code underlying [Bumblebee.Diffusion.StableDiffusion.text_to_image](https://github.com/elixir-nx/bumblebee/blob/main/lib/bumblebee/diffusion/stable_diffusion.ex) and [this notebook](https://github.com/fastai/diffusion-nbs/blob/master/Stable%20Diffusion%20Deep%20Dive.ipynb) from [fast.ai](https://fast.ai)

Let's start by processing the prompt - in this case processing means turn the natural language text into text embeddings.

The way SD works is we create outputs for two prompts: the conditional prompt which is the prompt we give it, and the unconditional prompt which is simply the empty string. The final result is a sort of weighted sum between these two results.

```elixir
text_input =
  Kino.Input.text("Prompt", default: "numbat, forest, high quality, detailed, digital art")
```

```elixir
repository_id = "CompVis/stable-diffusion-v1-4"

{:ok, tokenizer} = Bumblebee.load_tokenizer({:hf, "openai/clip-vit-large-patch14"})
```

<!-- livebook:{"output":true} -->

```
{:ok,
 %Bumblebee.Text.ClipTokenizer{
   tokenizer: #Tokenizers.Tokenizer<[
     vocab_size: 49408,
     continuing_subword_prefix: "",
     dropout: nil,
     end_of_word_suffix: "</w>",
     fuse_unk: false,
     model_type: "bpe",
     unk_token: "<|endoftext|>"
   ]>
 }}
```

```elixir
{:ok, unet} =
  Bumblebee.load_model({:hf, repository_id, subdir: "unet"},
    params_filename: "diffusion_pytorch_model.bin"
  )
```

<!-- livebook:{"output":true} -->

```

01:06:19.767 [info] TfrtCpuClient created.

```

<!-- livebook:{"output":true} -->

```
{:ok,
 %{
   model: #Axon<
     inputs: %{"encoder_hidden_state" => {nil, nil, 768}, "sample" => {nil, 64, 64, 4}, "timestep" => {}}
     outputs: "container_136"
     nodes: 1191
   >,
   params: %{
     "down_blocks.1.attentions.1.transformer_blocks.0.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133102>
         [0.06455663591623306, 0.015697991475462914, 0.0018226810498163104, 0.04101504758000374, 0.055111486464738846, -0.01491131167858839, 0.0015071012312546372, 0.008454488590359688, 0.039158374071121216, -0.026039646938443184, 0.08351129293441772, 0.04310309886932373, 0.021826576441526413, 0.07540702819824219, 0.012585926800966263, 0.018244720995426178, 0.0025295631494373083, -0.023807642981410027, -0.009354532696306705, 0.01346373837441206, -0.06430011242628098, 0.021891919896006584, -0.04448053240776062, -0.017868103459477425, 0.007842561230063438, -0.0034949718974530697, -0.030668383464217186, 0.04232094809412956, 0.013755992986261845, -0.024003269150853157, 0.08020710200071335, -0.07805481553077698, 0.004344793502241373, 0.03179062157869339, 0.06812698394060135, 0.037758488208055496, 0.01881113275885582, 0.013841585256159306, -0.06463246047496796, 0.03312345966696739, 0.020596571266651154, 0.009446832351386547, -0.008120370097458363, -2.5145846302621067e-4, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133103>
         [0.5418943166732788, 0.5530598163604736, 0.5654918551445007, 0.5168045163154602, 0.5379210710525513, 0.5561501979827881, 0.5141422152519226, 0.47319352626800537, 0.5389799475669861, 0.4653947055339813, 0.47669219970703125, 0.5331904888153076, 0.5631120204925537, 0.5798327326774597, 0.586775004863739, 0.5549855828285217, 0.5541852116584778, 0.5188616514205933, 0.5575286746025085, 0.5505492091178894, 0.46914902329444885, 0.5394877195358276, 0.4675045907497406, 0.5695308446884155, 0.5207520723342896, 0.5312385559082031, 0.5469288229942322, 0.5211780667304993, 0.5150048136711121, 0.4512820839881897, 0.5832325220108032, 0.5310543179512024, 0.5635734796524048, 0.5374594330787659, 0.4960234463214874, 0.5427218675613403, 0.5148271918296814, 0.48824411630630493, 0.4708886742591858, 0.5707486867904663, 0.5349480509757996, 0.5512299537658691, 0.524304986000061, ...]
       >
     },
     "down_blocks.2.resnets.1.norm2" => %{
       "beta" => #Nx.Tensor<
         f32[1280]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133000>
         [-0.11083422601222992, -0.15456882119178772, -0.171021968126297, -0.07672809064388275, -0.1302371770143509, -0.06758543103933334, -0.16323956847190857, -0.12456356734037399, -0.10810349136590958, -0.12829908728599548, -0.1075102761387825, -0.13897664844989777, -0.10531216859817505, -0.23417983949184418, -0.11198228597640991, -0.44602301716804504, -0.24149245023727417, -0.17768363654613495, -0.3240167498588562, -0.11996972560882568, -0.22730520367622375, -0.12424153834581375, -0.09703852981328964, -0.13037008047103882, -0.12884283065795898, -0.33944082260131836, -0.1108391135931015, -0.10933681577444077, -0.13977284729480743, -0.094076968729496, -0.10400847345590591, -0.2200995683670044, -0.1107514500617981, -0.28651687502861023, -0.6874585747718811, -0.13722556829452515, -0.08077177405357361, -0.12250201404094696, -0.12698028981685638, -0.09853895008563995, -0.08701556921005249, -0.13449928164482117, -0.12085910886526108, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[1280]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133001>
         [0.28407910466194153, 0.6593431234359741, 0.6248763799667358, 0.2749435603618622, 0.28368115425109863, 0.27577075362205505, 0.85692298412323, 0.29015055298805237, 0.3027878403663635, 0.2740626335144043, 0.26551249623298645, 0.2683927118778229, 0.2949567437171936, 0.5511330366134644, 0.2763454020023346, 1.0481808185577393, 0.6595509648323059, 0.6611158847808838, 0.8897375464439392, 0.29564765095710754, 0.6770428419113159, 0.2964545786380768, 0.30489975214004517, 0.2688322365283966, 0.2889963388442993, 0.8011043667793274, 0.2869980037212372, 0.27708080410957336, 0.273651659488678, 0.30301856994628906, 0.26510658860206604, 0.608389675617218, 0.28595036268234253, 0.7781409621238708, 1.4868149757385254, 0.29345834255218506, 0.2544216215610504, 0.26448699831962585, 0.28193527460098267, 0.3020195960998535, 0.4029087722301483, 0.28796690702438354, ...]
       >
     },
     "up_blocks.0.resnets.0.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[2560]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132974>
         [-0.40643882751464844, -0.2157077044248581, -0.1263309121131897, -0.19623500108718872, -0.25922107696533203, -0.47974756360054016, -0.46740370988845825, -0.33934494853019714, -0.4291228950023651, -0.1550232321023941, -0.16709759831428528, -0.2448950856924057, -0.1519133299589157, -0.35562995076179504, -0.09146745502948761, -0.7089171409606934, -0.12285127490758896, -0.1808745265007019, -0.10585640370845795, -0.10445302724838257, -0.28825798630714417, -0.19990403950214386, -0.24246445298194885, -0.13641412556171417, -0.17663046717643738, -0.11690010130405426, -0.799064040184021, -0.17254547774791718, -0.1270090937614441, -0.3669595420360565, -0.2061794400215149, -0.16004467010498047, -0.13598120212554932, -0.5628051161766052, -0.25368669629096985, -0.5195316672325134, -0.25964993238449097, -0.1270866096019745, -0.25022104382514954, -0.15196745097637177, -0.2612069845199585, -0.37038281559944153, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[2560]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132975>
         [0.7283202409744263, 0.6236720681190491, 0.5555914640426636, 0.5801222920417786, 0.6475843191146851, 0.67374187707901, 0.7264712452888489, 0.6379200220108032, 0.6800217628479004, 0.5276800990104675, 0.5756130218505859, 0.6339547038078308, 0.5415918827056885, 0.6778631806373596, 0.5228824615478516, 0.6618853807449341, 0.5377184152603149, 0.5877631902694702, 0.5375698804855347, 0.5076056718826294, 0.5734302997589111, 0.5910126566886902, 0.6124701499938965, 0.5233392715454102, 0.5226662755012512, 0.5562877058982849, 0.809286892414093, 0.5553544163703918, 0.5899105072021484, 0.6475679278373718, 0.6647294759750366, 0.5587079524993896, 0.5452415347099304, 0.65445876121521, 0.5894843935966492, 0.6945019364356995, 0.6547307372093201, 0.5390076637268066, 0.5642701983451843, 0.5535172820091248, 0.6404592394828796, ...]
       >
     },
     "down_blocks.0.attentions.0.transformer_blocks.0.attn1.to_v" => %{
       "kernel" => #Nx.Tensor<
         f32[320][320]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132395>
         [
           [-0.026856331154704094, -0.06186246499419212, -0.006703531369566917, -0.009901993907988071, -0.10146024823188782, 0.05434786528348923, 0.07344209402799606, -0.09762679040431976, -0.11685484647750854, -0.03009972721338272, 0.006645585875958204, -0.0035186302848160267, 0.025588713586330414, -0.03296806663274765, 0.033264972269535065, 0.11883875727653503, 0.0170498788356781, 0.049151066690683365, -0.048677533864974976, -0.04199331998825073, 0.006770018022507429, -0.03393744304776192, 0.028173083439469337, -0.026414107531309128, 0.06856197118759155, -0.0243832990527153, 0.014163150452077389, -0.017967984080314636, 0.03175676241517067, 0.062344055622816086, -0.028180493041872978, -0.08889202773571014, -0.067472904920578, 0.011304996907711029, 2.4865472369128838e-5, -0.02095366083085537, -0.0349639356136322, -0.024102764204144478, 0.07464320957660675, 0.016154838725924492, 0.026796238496899605, ...],
           ...
         ]
       >
     },
     "up_blocks.3.attentions.1.transformer_blocks.0.attn1.to_v" => %{
       "kernel" => #Nx.Tensor<
         f32[320][320]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132521>
         [
           [0.07550285756587982, -0.08061306923627853, -0.06222032010555267, -0.15268073976039886, 0.07264672219753265, -0.028279926627874374, 0.028020190075039864, -0.03847283124923706, -0.01441936194896698, -0.0614754855632782, 0.0386262983083725, 0.0841183066368103, 0.10104656219482422, -0.023304646834731102, 0.03754164278507233, -0.1222088485956192, -0.030576620250940323, 0.1382075697183609, 0.013364444486796856, 0.01646001823246479, -0.11029284447431564, 0.0035609202459454536, -0.0023911846801638603, 0.07130660116672516, 0.06081650033593178, -0.03800436481833458, -0.05107281357049942, 0.0076362756080925465, 0.08182092010974884, 0.15329879522323608, 0.09690957516431808, -0.04938038811087608, 0.06343813985586166, 0.11692272871732712, -0.04157271981239319, 0.011123034171760082, -0.01930626854300499, -0.10317717492580414, -0.1099640354514122, 0.09061893075704575, ...],
           ...
         ]
       >
     },
     "mid_block.attentions.0.transformer_blocks.0.attn2.to_k" => %{
       "kernel" => #Nx.Tensor<
         f32[768][1280]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132565>
         [
           [0.04392198100686073, 0.039226699620485306, 0.006409520283341408, 0.020917881280183792, -0.020636923611164093, 0.005988389253616333, 0.047699224203825, 0.016515173017978668, 0.037559233605861664, -0.013436893932521343, 0.02162247709929943, -0.059146780520677567, -0.011086651124060154, -0.06731835752725601, -0.012849327176809311, -0.05404040217399597, -0.006003109272569418, -0.04357476904988289, -0.013248165138065815, -0.019620485603809357, -0.010167564265429974, -0.029818883165717125, 0.028356952592730522, 0.014274604618549347, 0.02306428551673889, 0.08538570255041122, 0.008961709216237068, 0.010535548441112041, -0.07354594767093658, 0.01313613448292017, 0.027537083253264427, 0.020945148542523384, -0.029959434643387794, 0.026904257014393806, 0.01822565868496895, 0.028264958411455154, 0.0013619805686175823, -0.024536432698369026, 0.015526289120316505, ...],
           ...
         ]
       >
     },
     "up_blocks.3.resnets.1.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132614>
         [-0.019466491416096687, -0.2042829692363739, -0.04207085818052292, 0.09112785756587982, -0.05275987461209297, -0.02751476690173149, -0.01010922808200121, -0.07321785390377045, -0.06793776154518127, 0.01365204993635416, -0.009004645049571991, -0.06998522579669952, -4.108203575015068e-4, -0.009561160579323769, -0.012190751731395721, -0.10780934989452362, -0.019779549911618233, -0.005292933434247971, -0.0618550106883049, -0.09420501440763474, 0.012988385744392872, -0.0770261138677597, -0.0032619007397443056, -0.2536523938179016, 0.016861505806446075, -0.12471775710582733, -0.13966874778270721, -0.08833418786525726, -0.054430749267339706, -0.13628539443016052, -0.11026906967163086, -0.004038236569613218, 0.008360798470675945, -0.07290734350681305, 0.010272162035107613, -0.06111430004239082, -0.04155750200152397, -0.019638562574982643, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132615>
         [0.22156445682048798, 0.43291550874710083, 0.26350000500679016, 0.17439356446266174, 0.287519246339798, 0.2677513062953949, 0.19028492271900177, 0.3694363832473755, 0.3475053012371063, 0.19678863883018494, 0.16993050277233124, 0.3621816337108612, 0.22162581980228424, 0.1871441751718521, 0.22645439207553864, 0.36161255836486816, 0.20779356360435486, 0.21487455070018768, 0.25116029381752014, 0.30789434909820557, 0.18569308519363403, 0.33880770206451416, 0.18861202895641327, 0.5564283132553101, 0.2316242754459381, 0.30883127450942993, 0.43788212537765503, 0.3077019453048706, 0.38373270630836487, 0.4480995535850525, 0.3729453682899475, 0.21646104753017426, 0.23113755881786346, 0.3699384331703186, 0.17165154218673706, 0.29683661460876465, 0.2947925925254822, ...]
       >
     },
     "down_blocks.2.attentions.0.proj_in" => %{
       "bias" => #Nx.Tensor<
         f32[1280]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133068>
         [-0.010710720904171467, -0.02571064978837967, 0.009651273488998413, 0.07284154742956161, -0.016993524506688118, -0.004842521622776985, -0.01347244344651699, -0.035572174936532974, -0.043496958911418915, 0.01254185102880001, 0.027373963966965675, 0.05242334306240082, -0.035016197711229324, 0.006705865729600191, 0.024719182401895523, -0.017761042341589928, -0.057644911110401154, -0.02531607821583748, -0.009206855669617653, -0.005048186983913183, -0.011318806558847427, -0.009209491312503815, -0.005613789428025484, -0.03391464427113533, 0.005559219047427177, -0.027327269315719604, 0.004239549860358238, 0.021146364510059357, -0.01786987856030464, -0.0026487461291253567, -0.02167024277150631, -0.01030008215457201, 0.011426876299083233, -0.0020513867493718863, 0.003809357061982155, 0.024670898914337158, -0.010819836519658566, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[1][1][1280][1280]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132475>
         [
           [
             [
               [0.006072524469345808, 0.022490428760647774, -0.10547839850187302, -0.06084416061639786, 0.14041247963905334, 0.032115910202264786, -0.029837412759661674, -0.06333685666322708, 0.06645739078521729, 0.032747600227594376, -0.028250694274902344, -4.545804131339537e-6, 0.06117342785000801, 0.03604072332382202, 0.04661307856440544, -0.06054682284593582, 0.08545518666505814, -0.028699398040771484, 0.018472177907824516, -0.0725567638874054, -0.08323178440332413, 0.04253511130809784, 0.012471209280192852, 0.08468484878540039, 0.03802034258842468, -0.055450279265642166, 0.07978945970535278, 0.0721786841750145, 0.0917031466960907, 0.046059004962444305, -0.06865823268890381, 0.051981400698423386, 0.013303767889738083, 0.08007577806711197, -0.01670772023499012, 0.028639812022447586, ...],
               ...
             ]
           ]
         ]
       >
     },
     "mid_block.attentions.0.transformer_blocks.0.attn2.to_out.0" => %{
       "bias" => #Nx.Tensor<
         f32[1280]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132574>
         [0.006358011160045862, 0.016305429860949516, 0.01958194188773632, -0.007474541198462248, 0.02789505384862423, 0.0349486842751503, 0.010998125188052654, -0.0058104232884943485, -0.00409361720085144, 0.045890554785728455, -0.06414380669593811, -0.020071303471922874, -0.02034073881804943, -0.057164374738931656, -0.008794537745416164, 0.037674978375434875, 0.0203376654535532, 0.007213893812149763, -0.011746227741241455, 0.042568594217300415, -2.0535530347842723e-4, -0.019315985962748528, 0.029772890731692314, 0.00442960299551487, -0.04099879786372185, -9.009881759993732e-4, 0.02507946826517582, -0.04654791206121445, -0.010197537951171398, -0.07726693898439407, -0.04751434177160263, -0.007984853349626064, 0.001445829519070685, 0.0649648904800415, -0.01904105395078659, -0.012660443782806396, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[1280][1280]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132472>
         [
           [-0.02445261739194393, 0.020948177203536034, 0.007963762618601322, 0.004058902617543936, 0.009527538903057575, -0.030173802748322487, -0.018945826217532158, 0.03440376743674278, -2.572411030996591e-4, 0.008552282117307186, -0.06176096573472023, 0.05084037035703659, 0.006546479649841785, -0.004234498832374811, 0.032722149044275284, 0.027110420167446136, 0.014811658300459385, -0.009862290695309639, -0.03904552385210991, 0.045973971486091614, -0.026194341480731964, -7.068906561471522e-4, 0.015158994123339653, -0.017661934718489647, -0.015114469453692436, -0.026418525725603104, 0.021909188479185104, -0.004083764273673296, -0.037083711475133896, 0.05387270078063011, 0.02921530418097973, -0.020562412217259407, 0.002414499409496784, 0.005364013370126486, -0.007718381006270647, ...],
           ...
         ]
       >
     },
     "up_blocks.3.attentions.1.transformer_blocks.0.attn1.to_k" => %{
       "kernel" => #Nx.Tensor<
         f32[320][320]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132442>
         [
           [0.038888879120349884, -0.06459775567054749, -0.03236060589551926, -0.02730429731309414, 0.020116113126277924, 0.3144805133342743, 0.056657783687114716, -0.05437126010656357, -0.08715120702981949, 0.08577796816825867, -0.014769366011023521, -0.08727239072322845, -0.09112364053726196, -0.07138580083847046, 0.10244487971067429, -0.113813117146492, -0.13422957062721252, 0.1754315048456192, 0.11494104564189911, 0.13511580228805542, -0.07296104729175568, 0.0870429202914238, 0.001005150843411684, -0.025095365941524506, -0.1452089101076126, 0.11710148304700851, 0.17067991197109222, 0.29734599590301514, -0.022016994655132294, 0.1730637103319168, -0.19061610102653503, -0.15869079530239105, -0.05228933319449425, -0.01886815018951893, -0.048224132508039474, ...],
           ...
         ]
       >
     },
     "up_blocks.3.attentions.2.transformer_blocks.0.attn1.to_k" => %{
       "kernel" => #Nx.Tensor<
         f32[320][320]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132600>
         [
           [-0.22321458160877228, 0.015548859722912312, 0.29198282957077026, -0.07247654348611832, -0.11879832297563553, 0.17763389647006989, -0.14353537559509277, 0.05337310954928398, -0.06553496420383453, -0.19868679344654083, -0.2558053135871887, -0.055137187242507935, -0.02659805491566658, -0.19883903861045837, 0.013651527464389801, -0.2993151545524597, 0.05251172557473183, 0.02696136385202408, 0.1394280195236206, -0.2621733248233795, -0.2270030379295349, -0.00397839117795229, 0.016278820112347603, -0.044026732444763184, 0.03160810470581055, 0.017389731481671333, -0.10221396386623383, -0.01575527712702751, -0.07206954061985016, -0.03008623979985714, -0.09914891421794891, -0.07616407424211502, -0.19433088600635529, 0.2804652750492096, ...],
           ...
         ]
       >
     },
     "up_blocks.3.resnets.2.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132602>
         [-0.004098186269402504, -0.018414637073874474, -0.028857044875621796, 0.024723554030060768, -0.02808002382516861, -0.0063330866396427155, -0.09440997987985611, 0.017495378851890564, -0.02861879952251911, 0.017348645254969597, 0.004523867275565863, -7.359065930359066e-4, 0.02228725329041481, 0.020225463435053825, 0.01589381694793701, -0.04051655903458595, 0.017751183360815048, 0.0291544608771801, 0.06996017694473267, -0.04377579316496849, -0.006137647666037083, -0.022310703992843628, 0.004394823219627142, -0.0020044108387082815, -0.04599040374159813, -0.026142027229070663, -0.030352991074323654, -0.0499032586812973, -0.0010481954086571932, -0.012177162803709507, -0.027764631435275078, -0.010547219775617123, -0.018250158056616783, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132603>
         [0.17860910296440125, 0.1629682332277298, 0.22274531424045563, 0.4493323266506195, 0.17867501080036163, 0.18441630899906158, 0.46184390783309937, 0.30691805481910706, 0.3017699122428894, 0.16447973251342773, 0.24846208095550537, 0.16933277249336243, 0.1966928392648697, 0.22575236856937408, 0.269413024187088, 0.2090790718793869, 0.24511653184890747, 0.23391805589199066, 0.1295832246541977, 0.26153573393821716, 0.25818541646003723, 0.2235633283853531, 0.19035334885120392, 0.21867448091506958, 0.20382264256477356, 0.18295343220233917, 0.18242713809013367, 0.2964628040790558, 0.20749978721141815, 0.20793507993221283, 0.4418342113494873, 0.3476226329803467, ...]
       >
     },
     "down_blocks.1.attentions.0.transformer_blocks.0.attn2.to_v" => %{
       "kernel" => #Nx.Tensor<
         f32[768][640]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132396>
         [
           [-0.010494986549019814, -0.005680677480995655, 9.289911831729114e-4, 0.02358575165271759, -0.004660933744162321, -0.020843811333179474, -0.001730509102344513, -0.012347789481282234, 0.03247225657105446, 0.019281694665551186, 0.01903175190091133, 0.04335729405283928, -0.00851950142532587, -0.003248347667977214, 0.010381298139691353, -0.001542184385471046, 0.008185068145394325, 0.025082092732191086, 0.029173417016863823, 0.018101317808032036, 0.0013738799607381225, -0.008541494607925415, -0.010663570836186409, -0.009135201573371887, -0.004038820508867502, 0.0067071435041725636, -0.052264824509620667, -0.018317801877856255, -0.0035493976902216673, 0.014392441138625145, 0.0018918020650744438, -0.029067175462841988, ...],
           ...
         ]
       >
     },
     "up_blocks.2.attentions.1.proj_in" => %{
       "bias" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132792>
         [0.07070367783308029, 0.08636683225631714, 0.044186562299728394, -0.10993634909391403, -0.14757218956947327, -0.13795876502990723, -0.09646935760974884, 0.010708651505410671, 0.0722748339176178, 0.02659893035888672, -0.015290441922843456, -0.08553392440080643, 0.13585196435451508, 0.07944068312644958, 0.16108140349388123, 0.02871549315750599, -0.00608341908082366, -0.07952951639890671, 0.07020587474107742, 0.03481749817728996, -0.13729475438594818, 0.019851313903927803, 0.09115172922611237, 0.15017370879650116, 0.17585064470767975, 0.031501512974500656, 0.08966127783060074, -0.1602298766374588, 0.03456411510705948, 0.013191367499530315, 0.0670577809214592, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[1][1][640][640]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132478>
         [
           [
             [
               [-0.03938987851142883, 0.010213303379714489, 0.06908245384693146, -0.020614035427570343, -0.010409880429506302, -0.01345651876181364, -9.609978878870606e-4, -0.03253263235092163, 0.020603923127055168, -0.042909666895866394, -0.05953741446137428, 0.035622503608465195, -0.029388654977083206, 0.01678902469575405, 0.05464319884777069, 0.08963072299957275, -0.06253128498792648, -0.023902246728539467, 0.021368667483329773, 0.04040338099002838, -0.07542018592357635, -0.05399073660373688, -0.07496783882379532, -0.020767364650964737, -0.04092172160744667, -0.12746776640415192, 0.05770111829042435, 0.08248881995677948, -0.005380989983677864, -0.06501738727092743, ...],
               ...
             ]
           ]
         ]
       >
     },
     "up_blocks.2.resnets.0.norm2" => %{
       "beta" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132736>
         [-0.672954261302948, -0.6869456171989441, -0.37460920214653015, -0.7266537547111511, -0.22929473221302032, -0.3598649203777313, -0.4282391369342804, -0.4338763654232025, -0.36994948983192444, -0.639470636844635, -0.3889431655406952, 0.020097607746720314, -0.2810068726539612, -0.26992928981781006, -0.488253116607666, -0.4049863815307617, -0.3094883859157562, -0.6918948888778687, -0.02848132513463497, -0.3614695966243744, -0.3301352560520172, -0.4165351688861847, -0.6210759878158569, -0.01232203934341669, -0.5014375448226929, -0.43661031126976013, -0.34058907628059387, -0.42002180218696594, -0.706093966960907, -0.4085841774940491, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132737>
         [0.8979882597923279, 0.5732594728469849, 1.096969485282898, 1.8293747901916504, 1.1330190896987915, 1.0280572175979614, 1.3619781732559204, 1.8278963565826416, 1.0848116874694824, 1.5067917108535767, 1.3473341464996338, 1.569227695465088, 1.1672663688659668, 1.0541436672210693, 1.6462445259094238, 0.932446300983429, 1.1888760328292847, 1.5112578868865967, 1.544342279434204, 1.0997291803359985, 0.9441360235214233, 1.2095412015914917, 0.4869794249534607, 1.8065567016601562, 1.0907337665557861, 0.9325411915779114, 1.0949277877807617, 1.185789942741394, 1.4429347515106201, ...]
       >
     },
     "up_blocks.3.resnets.1.time_emb_proj" => %{
       "bias" => #Nx.Tensor<
         f32[320]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132610>
         [0.03217145800590515, -0.058662839233875275, 0.11958835273981094, 0.025692719966173172, 0.025645017623901367, 0.00783281959593296, -0.01265011914074421, -0.017053604125976562, 0.011617390438914299, -0.024539681151509285, 0.0032586490269750357, 0.013401935808360577, -0.047407377511262894, -0.01189496461302042, 0.017335595563054085, 0.04165222495794296, 0.010879716835916042, -0.017945805564522743, -0.01388125866651535, 0.01389921922236681, 0.017247019335627556, 0.008663777261972427, 0.010215806774795055, -0.03393854200839996, 0.05620577558875084, -0.0047044833190739155, 0.03430871665477753, -0.0047984737902879715, -0.010725118219852448, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[1280][320]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132552>
         [
           [0.002581274602562189, 0.0011873841285705566, 0.001286163809709251, -0.00135226605925709, 0.0038700855802744627, -0.002438720315694809, 0.007362942676991224, 0.0020527723245322704, 0.002728144871070981, 0.003385683288797736, -0.003772185882553458, 2.0239771401975304e-4, -0.006509345956146717, -0.002057794015854597, -0.0029676940757781267, -0.013900922611355782, -0.00568429147824645, -0.00227971188724041, -0.009295124560594559, -0.00520115764811635, -0.0022106466349214315, -0.002018796047195792, -0.009690468199551105, -0.004537129774689674, -0.005789184011518955, 0.0016185925342142582, -0.0028465783689171076, -0.002008562907576561, ...],
           ...
         ]
       >
     },
     "up_blocks.2.attentions.0.transformer_blocks.0.attn1.to_v" => %{
       "kernel" => #Nx.Tensor<
         f32[640][640]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132503>
         [
           [0.02318258211016655, -0.06968428194522858, 0.15107287466526031, 0.031592875719070435, 0.005355263128876686, 0.01732190139591694, -0.013423297554254532, -0.05074828490614891, -0.023555679246783257, 0.07220302522182465, -0.029986077919602394, -0.10861721634864807, -0.026388198137283325, 0.007893183268606663, -0.02517273649573326, 0.0028686688747256994, 0.032479897141456604, 0.013242477551102638, 0.015316659584641457, 0.014242047443985939, 0.03017544187605381, -0.0830300971865654, -0.04616059735417366, -0.051637087017297745, 0.030404305085539818, 0.05883205309510231, -0.029942229390144348, 0.02430698275566101, ...],
           ...
         ]
       >
     },
     "up_blocks.2.attentions.1.transformer_blocks.0.norm3" => %{
       "beta" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132772>
         [-0.06621836125850677, -0.07703889906406403, 0.05322697013616562, 0.047911591827869415, -0.0859019011259079, -0.0012158072786405683, -0.04564792662858963, -0.010297288186848164, -0.0449654757976532, 0.07518906891345978, -0.11203432828187943, 0.18661651015281677, -0.057954177260398865, 0.05783511698246002, -0.06864722073078156, 0.019807375967502594, -0.008498143404722214, -0.06074247136712074, -0.001681724563241005, -0.024556463584303856, -0.004712255205959082, 0.0208237674087286, -0.012823285534977913, 0.09539874643087387, 0.06805562973022461, -0.1516282558441162, 0.03248238563537598, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132773>
         [0.48363807797431946, 0.49399706721305847, 0.4974454343318939, 0.48579084873199463, 0.5294474959373474, 0.5055488348007202, 0.5101813077926636, 0.5041550993919373, 0.5055208206176758, 0.5327012538909912, 0.5192967057228088, 0.5075795650482178, 0.5288653373718262, 0.5178026556968689, 0.4969461262226105, 0.49491021037101746, 0.48558202385902405, 0.4908143877983093, 0.4786878526210785, 0.5213141441345215, 0.49349653720855713, 0.49293771386146545, 0.5216169953346252, 0.5544036626815796, 0.512702226638794, 0.5031489133834839, ...]
       >
     },
     "down_blocks.2.attentions.0.transformer_blocks.0.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[1280]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133052>
         [0.007826208136975765, -0.02554926462471485, 0.0034833054523915052, 0.009057240560650826, 0.007728899829089642, -0.005956787150353193, -0.005776950623840094, 0.05066332221031189, -0.00872680265456438, 0.009553018026053905, 0.013835696503520012, -9.876317344605923e-4, 0.004531783051788807, -0.0056093307211995125, 0.0046669840812683105, -0.02546514756977558, 0.01642969623208046, -0.003841587109491229, 0.005876685027033091, 0.03465621918439865, 0.014536052942276001, 0.004784698132425547, 0.008210997097194195, 0.005766070447862148, 0.02095627598464489, 0.011763950809836388, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[1280]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133053>
         [0.2881941497325897, 0.29114726185798645, 0.3125823438167572, 0.31339597702026367, 0.27644896507263184, 0.33137860894203186, 0.2551131248474121, 0.26063644886016846, 0.33975842595100403, 0.266656756401062, 0.2603507339954376, 0.17932942509651184, 0.3066568076610565, 0.17621734738349915, 0.3314661979675293, 0.32209911942481995, 0.3235921859741211, 0.24059051275253296, 0.19678214192390442, 0.29711270332336426, 0.3129734992980957, 0.29678741097450256, 0.2551572322845459, 0.3149714171886444, 0.33327430486679077, ...]
       >
     },
     "mid_block.attentions.0.transformer_blocks.0.attn1.to_k" => %{
       "kernel" => #Nx.Tensor<
         f32[1280][1280]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132657>
         [
           [0.005353614687919617, -0.02784123457968235, -2.322180662304163e-4, 0.07858981192111969, -0.03053274191915989, -0.009779094718396664, -0.017482466995716095, -0.032869793474674225, -0.004636324942111969, -0.04379979893565178, -0.011677832342684269, 0.059378866106271744, -0.05010320246219635, 0.0437028668820858, 0.030471213161945343, -0.02997269667685032, 0.00632749916985631, 0.06223268806934357, -0.0180559903383255, -0.0035199462436139584, 0.005907684098929167, 0.057746633887290955, -0.012473109178245068, 4.548593715298921e-4, 0.02564706839621067, ...],
           ...
         ]
       >
     },
     "up_blocks.3.attentions.1.transformer_blocks.0.attn2.to_v" => %{
       "kernel" => #Nx.Tensor<
         f32[768][320]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132549>
         [
           [0.003336890833452344, -0.007086077239364386, -0.01771327294409275, 0.008401699364185333, 0.0291095282882452, -0.026252133771777153, -0.018599659204483032, -0.002841432113200426, 0.03290718421339989, 0.002708457875996828, 0.02987784333527088, -0.022050416097044945, -0.014787807129323483, 0.0029661296866834164, 0.023116065189242363, 0.01934719830751419, -0.017479272559285164, 0.038219429552555084, -0.020195933058857918, -0.010574713349342346, 0.0025031997356563807, -5.654583583236672e-5, -0.017308156937360764, -0.01903984323143959, ...],
           ...
         ]
       >
     },
     "up_blocks.1.attentions.2.transformer_blocks.0.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[1280]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132866>
         [-0.017540892586112022, 0.005560043267905712, 0.017081694677472115, -0.03531450033187866, 0.011902953498065472, -0.03599700331687927, 0.021938970312476158, -0.00673519354313612, -0.010325330309569836, -0.054268985986709595, -0.0053432052955031395, 0.01548010390251875, -0.02039383165538311, -0.006469426676630974, 6.922579486854374e-4, -0.017662061378359795, 0.010503537021577358, -0.03648078814148903, 0.005613007117062807, -0.05444135144352913, -0.01799379289150238, 0.016960902139544487, 0.014598166570067406, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[1280]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132867>
         [0.2860337197780609, 0.3031468987464905, 0.28936323523521423, 0.2946993410587311, 0.29421982169151306, 0.30395907163619995, 0.3132919371128082, 0.33059167861938477, 0.32970404624938965, 0.2726888656616211, 0.32649940252304077, 0.28985396027565, 0.3075631260871887, 0.3158923089504242, 0.32868078351020813, 0.29384511709213257, 0.32508936524391174, 0.28836074471473694, 0.31252965331077576, 0.31226876378059387, 0.3069353699684143, 0.30857226252555847, ...]
       >
     },
     "up_blocks.2.attentions.2.transformer_blocks.0.attn1.to_out.0" => %{
       "bias" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132761>
         [0.0018977519357576966, -0.01414724811911583, -0.01700877770781517, 0.003434839891269803, -0.013097633607685566, -0.00797971524298191, 0.009526632726192474, 0.008658724837005138, 0.01760772429406643, 0.0021474130917340517, 0.015031753107905388, -0.022509755566716194, 0.044431183487176895, -0.010490409098565578, -0.03317201882600784, 0.018062960356473923, -0.014064108021557331, 0.02269400656223297, 0.019239185377955437, 0.02859010361135006, -0.007434334140270948, -0.0035660858266055584, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[640][640]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132399>
         [
           [0.02536964789032936, -0.024882705882191658, -0.10825913399457932, 0.13901033997535706, 0.013911500573158264, 0.06489993631839752, -0.023716947063803673, 0.006087122485041618, 0.07833443582057953, 0.004177782218903303, 0.15717928111553192, -0.04713220149278641, 0.0744868814945221, -0.03324458375573158, 0.028243688866496086, -0.009324932470917702, -0.02403057925403118, -0.042537763714790344, -0.02395307831466198, 0.014507654123008251, -0.05295654013752937, ...],
           ...
         ]
       >
     },
     "down_blocks.1.attentions.1.transformer_blocks.0.attn1.to_q" => %{
       "kernel" => #Nx.Tensor<
         f32[640][640]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132589>
         [
           [0.03137167915701866, -0.09759481251239777, 0.12118766456842422, -0.05683690309524536, -0.013261482119560242, -0.0829118937253952, -0.025035293772816658, -0.05804723501205444, -0.042816162109375, 0.24040526151657104, -9.814029326662421e-4, -0.07244224846363068, -0.008974794298410416, 0.049482934176921844, 0.15036757290363312, 0.05569319799542427, -0.06115806847810745, 0.011815422214567661, 0.047421347349882126, 0.0016521975630894303, 0.17454078793525696, ...],
           ...
         ]
       >
     },
     "down_blocks.1.resnets.1.conv1" => %{
       "bias" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133080>
         [0.027217499911785126, 0.011587620712816715, -0.05359405651688576, 0.05977220460772514, -0.0019371142843738198, -0.07347432523965836, 0.07108837366104126, -0.022302355617284775, 0.012531939893960953, 0.008162706159055233, 0.027169879525899887, -0.08788955211639404, 0.02577218785881996, 0.05857795104384422, 0.06421514600515366, -0.057337917387485504, 0.06370099633932114, 0.04415219649672508, -0.01958247646689415, 0.06182471290230751, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][640][640]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132376>
         [
           [
             [
               [-0.0010461827041581273, -0.008276396431028843, -0.00924390647560358, -0.02165837213397026, -0.0023428834974765778, -0.005535959731787443, 0.027600323781371117, 0.04882179945707321, -0.02570105530321598, -0.0568641722202301, -0.021600646898150444, 0.00900952983647585, 0.006877852138131857, 0.035656172782182693, 0.06422112137079239, -0.05671801418066025, 0.03600618243217468, 0.02944623865187168, 0.018905354663729668, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "up_blocks.2.resnets.2.conv1" => %{
       "bias" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132716>
         [0.024087468162178993, 0.016737958416342735, 0.03573041409254074, -0.04349743574857712, 0.0022092992439866066, 0.03549634665250778, 0.027100112289190292, 0.031903259456157684, -0.042864080518484116, 0.09324324876070023, 0.02111559547483921, 0.007764657959342003, 0.011773754842579365, -0.011927071027457714, 0.03726134076714516, -0.015048949047923088, -0.0073334467597305775, 0.003619227558374405, -0.021889476105570793, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][960][640]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132666>
         [
           [
             [
               [0.0019691833294928074, -0.014468679204583168, -0.05005139112472534, -0.03575284034013748, -0.027374297380447388, -0.05275131016969681, 0.0016430310206487775, -0.01596667617559433, -0.029059212654829025, -0.03797232732176781, -0.0018816546071320772, -0.030095163732767105, -0.023397602140903473, -0.027097389101982117, 0.03260459750890732, 0.04591163992881775, -0.010610856115818024, -0.017143992707133293, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "up_blocks.2.attentions.2.proj_in" => %{
       "bias" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132766>
         [0.024293238297104836, 0.08764872699975967, -0.05226704478263855, 0.04590984061360359, -0.045930515974760056, 0.01984368823468685, 0.06886507570743561, 0.06724585592746735, 0.05774306505918503, -0.042065609246492386, 0.04466865956783295, -4.43911412730813e-5, 0.13534651696681976, -0.006066930014640093, -0.16202564537525177, 0.017928913235664368, -0.05688699334859848, 0.08554340153932571, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[1][1][640][640]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132582>
         [
           [
             [
               [-0.06803550571203232, -0.03094242513179779, 0.023452118039131165, 0.07029061764478683, -0.008743349462747574, 0.0817292258143425, -0.07172565162181854, 0.040616218000650406, -0.05043575167655945, 0.033864736557006836, -0.09656200557947159, 0.09573769569396973, -0.024591805413365364, -0.01932019367814064, -0.04889114946126938, 0.07985898107290268, -0.00513507891446352, ...],
               ...
             ]
           ]
         ]
       >
     },
     "up_blocks.3.attentions.2.transformer_blocks.0.ff.net.2" => %{
       "bias" => #Nx.Tensor<
         f32[320]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132641>
         [-0.0015640592901036143, -0.05101226270198822, 0.04811135679483414, -0.055466488003730774, 0.07315004616975784, -0.08159860223531723, -0.07107139378786087, -0.003935663960874081, 0.08298338204622269, -0.05254186689853668, 0.01848934404551983, 0.07172529399394989, 0.0659434124827385, -0.0345168299973011, 0.018118180334568024, -0.03878099471330643, -0.07203353941440582, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[1280][320]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132405>
         [
           [0.017801916226744652, 0.09796249866485596, -0.020011302083730698, -0.07531537860631943, 0.02862822636961937, 0.006747085135430098, -0.023535139858722687, 0.21858277916908264, -0.049473416060209274, 0.007191886659711599, -0.12239185720682144, 0.06836844235658646, 0.10073614865541458, 0.03218816965818405, 0.10058934986591339, 0.15713033080101013, ...],
           ...
         ]
       >
     },
     "down_blocks.2.attentions.0.transformer_blocks.0.attn1.to_k" => %{
       "kernel" => #Nx.Tensor<
         f32[1280][1280]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132602>
         [
           [0.11157455295324326, 0.02388674207031727, 0.0023151009809225798, -0.02296530455350876, -0.02013542130589485, -0.016378864645957947, -0.13063973188400269, 0.04796900227665901, 0.03407469391822815, -0.14159125089645386, 0.009175394661724567, -0.13630209863185883, -0.015809375792741776, -0.011711237952113152, 0.0031370779033750296, 0.09782582521438599, ...],
           ...
         ]
       >
     },
     "up_blocks.1.attentions.2.transformer_blocks.0.attn1.to_out.0" => %{
       "bias" => #Nx.Tensor<
         f32[1280]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132877>
         [-0.011076198890805244, 0.03562311828136444, 0.0402008593082428, -0.018486062064766884, -0.01858990266919136, -0.007765790447592735, 0.01767098344862461, 0.021609168499708176, -0.012322243303060532, -0.06213172897696495, -0.019041594117879868, -0.02807300165295601, -0.01644280180335045, -0.005176183767616749, -6.869209464639425e-4, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[1280][1280]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132558>
         [
           [0.012786616571247578, 0.014788768254220486, 0.0012046035844832659, 5.959590198472142e-4, -0.12399114668369293, 0.001907148165628314, 0.04488198086619377, -0.01613539084792137, -0.06967437267303467, -0.05586319789290428, 0.05464094132184982, -0.07328440994024277, 0.011317304335534573, 0.03395532816648483, ...],
           ...
         ]
       >
     },
     "mid_block.attentions.0.transformer_blocks.0.ff.net.2" => %{
       "bias" => #Nx.Tensor<
         f32[1280]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132579>
         [0.03309331461787224, -0.050229262560606, 8.641189197078347e-4, -0.09254031628370285, 0.020409494638442993, 0.025896918028593063, -0.031963031738996506, 0.014692030847072601, 0.055306218564510345, 0.05922723188996315, -0.027427425608038902, 0.03742891550064087, -0.02458692342042923, -0.01819816417992115, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[5120][1280]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132483>
         [
           [0.018152454867959023, -0.020625043660402298, 0.007983175106346607, 0.035172238945961, 0.04926636815071106, -0.009984295815229416, 0.00681329658254981, 0.04651404917240143, -0.060837067663669586, 0.023532334715127945, -6.047614151611924e-4, -0.010492687113583088, 0.07290583103895187, ...],
           ...
         ]
       >
     },
     "down_blocks.1.resnets.0.norm2" => %{
       "beta" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133088>
         [-0.09591235220432281, -0.09239111095666885, -0.1128886416554451, -0.09611648321151733, -0.15748699009418488, -0.04834146797657013, -0.07446739077568054, -0.06964521110057831, -0.06554319709539413, -0.11142310500144958, -0.052559271454811096, -0.09419860690832138, -0.0942484512925148, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133089>
         [0.2647842764854431, 0.2415798008441925, 0.2510737180709839, 0.2534579336643219, 1.1600755453109741, 0.2549353539943695, 0.2560495436191559, 0.2654797434806824, 0.2483185976743698, 0.26888251304626465, 0.23274420201778412, 0.2706076502799988, ...]
       >
     },
     "down_blocks.1.attentions.1.transformer_blocks.0.attn1.to_k" => %{
       "kernel" => #Nx.Tensor<
         f32[640][640]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132377>
         [
           [-0.018114600330591202, -0.055732667446136475, -0.01670544594526291, -0.13416688144207, -0.01640312746167183, -0.03920740261673927, -0.0452611967921257, -0.023857656866312027, 0.030106689780950546, -0.012760625220835209, -0.06652071326971054, -0.04721898213028908, ...],
           ...
         ]
       >
     },
     "down_blocks.2.attentions.0.transformer_blocks.0.attn2.to_v" => %{
       "kernel" => #Nx.Tensor<
         f32[768][1280]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132534>
         [
           [-0.007765908259898424, -0.01816103607416153, -0.01362584251910448, -0.019889652729034424, -0.008094009011983871, -0.04449562728404999, 0.06446840614080429, 0.02285417914390564, 0.034271832555532455, 0.019155940040946007, -0.0066931708715856075, ...],
           ...
         ]
       >
     },
     "down_blocks.0.attentions.1.transformer_blocks.0.ff.net.0.proj" => %{
       "bias" => #Nx.Tensor<
         f32[2560]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133185>
         [-0.009375160560011864, -0.06007179245352745, -0.030178679153323174, -0.043172214180231094, 0.03127346932888031, 0.021814191713929176, 0.005314243026077747, -0.007796605117619038, -0.025855837389826775, 0.015336429700255394, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[320][2560]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132391>
         [
           [-0.019183587282896042, 0.012664573267102242, 0.0546535886824131, -0.05843932926654816, 0.09160087257623672, -0.10664194077253342, -0.0427321158349514, -0.033689096570014954, 0.03578628599643707, ...],
           ...
         ]
       >
     },
     "down_blocks.1.resnets.0.conv1" => %{
       "bias" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133092>
         [0.025868769735097885, 0.001384483533911407, 0.020847300067543983, 0.015170995146036148, 0.028994319960474968, 0.0214011799544096, 0.017458476126194, 0.021354367956519127, 0.027814947068691254, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][320][640]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132485>
         [
           [
             [
               [-0.0038948182482272387, 0.030841488391160965, -0.030144838616251945, 0.04750218242406845, -0.06707935035228729, -0.030690191313624382, -0.09175830334424973, -0.00794856809079647, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "up_blocks.1.resnets.0.time_emb_proj" => %{
       "bias" => #Nx.Tensor<
         f32[1280]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132854>
         [0.1002156138420105, 0.08164840936660767, 0.07651741802692413, 0.04173322394490242, 0.06996269524097443, -0.028320185840129852, 0.1088842898607254, 0.015944544225931168, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[1280][1280]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132528>
         [
           [-0.005554345436394215, -0.006245982367545366, 0.0010568874422460794, 0.005318684969097376, 0.0045993635430932045, 3.909385995939374e-4, -0.008990931324660778, ...],
           ...
         ]
       >
     },
     "up_blocks.1.attentions.1.transformer_blocks.0.attn1.to_v" => %{
       "kernel" => #Nx.Tensor<
         f32[1280][1280]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132418>
         [
           [0.04134700074791908, -0.05295422673225403, 0.004395177122205496, 0.021922681480646133, 0.13420681655406952, -0.026902293786406517, 0.0076027484610676765, ...],
           ...
         ]
       >
     },
     "down_blocks.1.attentions.0.transformer_blocks.0.ff.net.2" => %{
       "bias" => #Nx.Tensor<
         f32[640]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133135>
         [-0.003259039716795087, 0.009203321300446987, 1.198007958009839e-4, -0.008854898624122143, -0.01770801842212677, 0.016263892874121666, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[2560][640]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132387>
         [
           [0.04591355845332146, -0.07726676762104034, -0.013766811229288578, -0.010077890940010548, 0.08293934166431427, ...],
           ...
         ]
       >
     },
     "up_blocks.1.attentions.2.transformer_blocks.0.attn1.to_v" => %{
       "kernel" => #Nx.Tensor<
         f32[1280][1280]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132381>
         [
           [0.03551943227648735, -0.10719381272792816, 0.012951437383890152, -0.09027128666639328, 0.057645127177238464, ...],
           ...
         ]
       >
     },
     "time_embedding.linear_2" => %{
       "bias" => #Nx.Tensor<
         f32[1280]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133222>
         [0.0064439973793923855, 0.0018883653683587909, -0.010009421035647392, -9.435531683266163e-4, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[1280][1280]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132529>
         [
           [0.002870282158255577, -0.001149905612692237, 2.329881099285558e-4, ...],
           ...
         ]
       >
     },
     "up_blocks.3.attentions.1.transformer_blocks.0.attn1.to_out.0" => %{
       "bias" => #Nx.Tensor<
         f32[320]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132671>
         [-0.051842331886291504, 0.042582008987665176, -6.644449313171208e-4, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[320][320]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132370>
         [
           [-0.006472086533904076, 0.07094775140285492, ...],
           ...
         ]
       >
     },
     "up_blocks.2.attentions.0.transformer_blocks.0.attn2.to_v" => %{
       "kernel" => #Nx.Tensor<
         f32[768][640]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132661>
         [
           [-0.0527946911752224, -0.007192081771790981, ...],
           ...
         ]
       >
     },
     "up_blocks.3.attentions.0.transformer_blocks.0.attn1.to_q" => %{
       "kernel" => #Nx.Tensor<
         f32[320][320]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132393>
         [
           [-0.1039244681596756, ...],
           ...
         ]
       >
     },
     "up_blocks.1.attentions.1.proj_out" => %{
       "bias" => #Nx.Tensor<
         f32[1280]
         EXLA.Backend<host:0, 0.4102548783.2000027682.132886>
         [...]
       >,
       ...
     },
     "up_blocks.1.resnets.0.norm1" => %{...},
     ...
   },
   spec: %Bumblebee.Diffusion.UNet2DConditional{
     architecture: :base,
     sample_size: 64,
     in_channels: 4,
     out_channels: 4,
     center_input_sample: false,
     embedding_flip_sin_to_cos: true,
     embedding_frequency_correction_term: 0,
     hidden_sizes: [320, 640, 1280, 1280],
     depth: 2,
     down_block_types: [:cross_attention_down_block, :cross_attention_down_block,
      :cross_attention_down_block, :down_block],
     up_block_types: [:up_block, :cross_attention_up_block, :cross_attention_up_block,
      :cross_attention_up_block],
     downsample_padding: [{1, 1}, {1, 1}],
     mid_block_scale_factor: 1,
     num_attention_heads: 8,
     cross_attention_size: 768,
     activation: :silu,
     group_norm_num_groups: 32,
     group_norm_epsilon: 1.0e-5
   }
 }}
```

```elixir
{:ok, clip} = Bumblebee.load_model({:hf, repository_id, subdir: "text_encoder"})
```

<!-- livebook:{"output":true} -->

```

01:06:34.329 [debug] the following PyTorch parameters were unused:

  * text_model.embeddings.position_ids


```

<!-- livebook:{"output":true} -->

```
{:ok,
 %{
   model: #Axon<
     inputs: %{"attention_mask" => {nil, nil}, "input_ids" => {nil, nil}, "position_ids" => {nil, nil}}
     outputs: "container_25"
     nodes: 348
   >,
   params: %{
     "text_model.encoder.layers.5.layer_norm2" => %{
       "beta" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133373>
         [0.05503242090344429, 0.3417016565799713, -0.5991420745849609, 0.05744205787777901, -0.5928930640220642, 0.6210476160049438, 0.7226051688194275, -0.38349589705467224, 0.530756950378418, -0.3448982536792755, -0.375155508518219, 0.7639660239219666, -0.4846639335155487, -0.19540263712406158, 0.23204734921455383, 0.6663860082626343, 0.03816477581858635, 0.4763227701187134, -0.752906858921051, -1.474980115890503, 0.5027968287467957, 0.42079317569732666, 0.5003476738929749, -0.44191253185272217, 0.477628231048584, -0.5668026804924011, -0.37597841024398804, 0.0035411156713962555, -0.6228733658790588, 0.5551721453666687, -0.18523024022579193, 0.22972369194030762, -0.3019280731678009, -0.4029120206832886, -0.28642523288726807, -0.14824838936328888, -0.9781745672225952, -0.25017043948173523, 0.3097626566886902, 0.9130802154541016, -0.3720938563346863, 0.050364259630441666, 0.839472234249115, 0.1054566279053688, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133374>
         [2.1306240558624268, 2.0980987548828125, 2.1662583351135254, 2.0829050540924072, 1.7951185703277588, 2.1608197689056396, 2.2010395526885986, 2.090855598449707, 2.2347300052642822, 2.1553030014038086, 2.084630250930786, 2.249356985092163, 2.23956298828125, 2.1284821033477783, 2.137233257293701, 2.0650417804718018, 2.1097571849823, 2.1325175762176514, 2.2689578533172607, 1.6700023412704468, 2.261260747909546, 2.187866449356079, 2.159013271331787, 2.085486888885498, 2.13934326171875, 2.179300546646118, 2.0696771144866943, 2.070558547973633, 2.0371015071868896, 2.0495331287384033, 2.193248748779297, 2.1432278156280518, 2.1055920124053955, 2.1177735328674316, 2.0806400775909424, 2.0541977882385254, 2.3682119846343994, 2.0191903114318848, 2.0317671298980713, 2.240257978439331, 2.0286247730255127, 2.073836326599121, 2.1933462619781494, ...]
       >
     },
     "text_model.encoder.layers.2.self_attn.k_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133435>
         [-0.0040740966796875, 4.334449768066406e-4, 0.0015239715576171875, 3.1375885009765625e-4, 0.007709503173828125, 0.004726409912109375, -0.00925445556640625, 0.002254486083984375, 0.002716064453125, 0.0134735107421875, 0.002941131591796875, -2.9015541076660156e-4, 0.00313568115234375, -8.864402770996094e-4, 0.0019330978393554688, -0.0021648406982421875, 8.32676887512207e-5, 0.003948211669921875, -9.665489196777344e-4, 9.050369262695312e-4, 0.0031223297119140625, -0.0010623931884765625, -0.003673553466796875, -0.00292205810546875, 0.0081329345703125, 4.963874816894531e-4, 1.8477439880371094e-4, 0.0014276504516601562, 0.00439453125, -0.01236724853515625, 0.0019702911376953125, 1.7213821411132812e-4, 0.006305694580078125, -2.6524066925048828e-5, -0.002796173095703125, -3.331899642944336e-5, 0.004451751708984375, 0.0037784576416015625, 9.04083251953125e-4, 0.0030803680419921875, -5.145072937011719e-4, 0.004741668701171875, -0.00524139404296875, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132824>
         [
           [-0.004451751708984375, 0.003238677978515625, 0.00331878662109375, 0.01406097412109375, 0.01145172119140625, -0.004985809326171875, 0.0016021728515625, 0.042266845703125, 0.01043701171875, 0.006061553955078125, -0.007007598876953125, 0.0195159912109375, 0.0236663818359375, 0.0031108856201171875, 0.00923919677734375, 0.01078033447265625, 0.036865234375, 0.0296630859375, -0.0265045166015625, 0.0252685546875, -0.01282501220703125, 0.006771087646484375, -0.008636474609375, -0.0035305023193359375, -0.01029205322265625, 0.02081298828125, -0.0015544891357421875, -0.003276824951171875, 0.0277099609375, -0.005809783935546875, 0.003894805908203125, 0.0162506103515625, -6.508827209472656e-5, -0.03857421875, 0.0202178955078125, -0.005619049072265625, 0.00829315185546875, 0.01499176025390625, 0.0177459716796875, 0.01018524169921875, 0.002376556396484375, -0.031036376953125, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.7.mlp.fc1" => %{
       "bias" => #Nx.Tensor<
         f32[3072]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133345>
         [-0.35400390625, -0.27880859375, -0.386474609375, -0.2265625, -0.38818359375, -0.372802734375, -0.307373046875, -0.388671875, -0.338134765625, -0.322021484375, -0.279052734375, -0.357177734375, -0.368408203125, -0.3212890625, -0.294189453125, -0.237060546875, -0.397705078125, -0.3349609375, -0.23974609375, -0.347412109375, -0.343017578125, -0.338623046875, 0.1513671875, -0.179931640625, -0.35595703125, -0.4052734375, -0.31640625, -0.357666015625, -0.2705078125, -0.367431640625, -0.2274169921875, -0.33154296875, -0.44873046875, -0.295166015625, -0.4443359375, -0.2998046875, -0.335205078125, -0.1968994140625, -0.159423828125, -0.379150390625, -0.33935546875, -0.3828125, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][3072]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132833>
         [
           [0.0248565673828125, -0.031646728515625, -0.035003662109375, 0.01100921630859375, 0.00382232666015625, -0.004962921142578125, 0.027923583984375, -0.0111083984375, 0.027069091796875, -0.004459381103515625, 0.0154571533203125, 0.001148223876953125, 0.0179901123046875, 3.387928009033203e-4, -0.0124053955078125, -0.00728607177734375, 0.002105712890625, 0.032012939453125, -0.004241943359375, -0.01332855224609375, 0.0182037353515625, 9.026527404785156e-4, -0.01009368896484375, 0.00572967529296875, 0.01171112060546875, -0.0357666015625, -0.00222015380859375, 0.00872802734375, 0.015106201171875, -0.007007598876953125, 0.01320648193359375, 0.013824462890625, -0.005580902099609375, -0.020233154296875, -0.00383758544921875, 0.0103912353515625, -0.001834869384765625, -0.002010345458984375, 0.00385284423828125, -0.005779266357421875, 0.025054931640625, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.5.layer_norm1" => %{
       "beta" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133379>
         [0.09504030644893646, 0.06226426362991333, -0.11089535802602768, -0.018604468554258347, 0.08069829642772675, 0.13615642488002777, 0.06903206557035446, 0.03695225715637207, -0.13560910522937775, -0.002660728059709072, 0.058486904948949814, -0.033612776547670364, -0.08910321444272995, -0.015545215457677841, -0.09279587864875793, -0.050927888602018356, -0.012087934650480747, -0.027952756732702255, -0.015457670204341412, 4.868903160095215, -0.09400094300508499, 0.04349836707115173, -0.015977542847394943, 0.0029512534383684397, -0.053258296102285385, 0.014906884171068668, -0.017444362863898277, 0.005456498358398676, 0.052729249000549316, -0.08518578112125397, 0.041780002415180206, 0.02244797721505165, 0.026539601385593414, 0.07743823528289795, 0.057398732751607895, -0.037843119353055954, 0.03181000053882599, -0.03578165918588638, -0.13307137787342072, 0.042216956615448, 0.04004203900694847, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133380>
         [1.4388813972473145, 1.549230694770813, 1.4443720579147339, 1.436888337135315, 1.469569206237793, 1.5982180833816528, 1.4797632694244385, 1.496244192123413, 1.5059325695037842, 1.420149803161621, 1.5556026697158813, 1.4056161642074585, 1.4634329080581665, 1.550033688545227, 1.3879979848861694, 1.4895167350769043, 1.4534834623336792, 1.6242035627365112, 1.4925343990325928, 0.4318936765193939, 1.4099355936050415, 1.5599099397659302, 1.5427641868591309, 1.4730921983718872, 1.5599424839019775, 1.4930553436279297, 1.578843116760254, 1.4391251802444458, 1.6308456659317017, 1.4246456623077393, 1.5023850202560425, 1.5214582681655884, 1.4943090677261353, 1.5266649723052979, 1.5500210523605347, 1.5011382102966309, 1.470906376838684, 1.533420443534851, 1.5236482620239258, 1.4503904581069946, ...]
       >
     },
     "text_model.encoder.layers.6.mlp.fc2" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133359>
         [0.076416015625, 0.0394287109375, -0.1373291015625, 0.058135986328125, 0.039581298828125, 0.07415771484375, 0.057098388671875, -0.0036792755126953125, -0.006153106689453125, 0.01209259033203125, 0.0203857421875, -0.03765869140625, -0.1512451171875, -0.0831298828125, 0.0228271484375, -1.5556812286376953e-5, -0.09210205078125, -0.0076751708984375, -0.0215606689453125, -0.1956787109375, 0.03155517578125, 0.0391845703125, 7.43865966796875e-4, -0.039825439453125, 0.05615234375, 0.00133514404296875, 0.03265380859375, -4.448890686035156e-4, -0.08245849609375, 0.044403076171875, -0.0234375, 0.08294677734375, 0.0291748046875, -0.00533294677734375, 0.08587646484375, -0.0151214599609375, -0.006740570068359375, 0.0704345703125, 0.020416259765625, 0.06463623046875, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3072][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132802>
         [
           [-0.020263671875, 0.0079193115234375, 0.018585205078125, 0.0018892288208007812, -0.0100555419921875, -0.0306549072265625, 0.0235443115234375, 0.0294189453125, -0.016876220703125, 0.01096343994140625, 7.410049438476562e-4, 0.013824462890625, 0.003940582275390625, -0.004482269287109375, -0.0267486572265625, -0.00997161865234375, 0.00977325439453125, -0.00902557373046875, 0.01154327392578125, 0.016998291015625, -0.006988525390625, 0.01006317138671875, -0.01155853271484375, 0.0013227462768554688, 0.0189666748046875, -0.0247955322265625, -0.007595062255859375, 0.0128173828125, 0.02178955078125, 3.5703182220458984e-5, -0.01074981689453125, -0.0014219284057617188, 0.001575469970703125, -9.46044921875e-4, -0.0227813720703125, 0.007167816162109375, -0.0243988037109375, 0.017822265625, -0.0253143310546875, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.10.layer_norm1" => %{
       "beta" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133299>
         [0.1571398675441742, 0.1052076518535614, -0.21854984760284424, -0.03635241463780403, 0.18206776678562164, 0.17250555753707886, 0.1329038292169571, 0.07078210264444351, -0.1926565170288086, -0.09216846525669098, 0.07918404787778854, -0.058226220309734344, -0.1793455183506012, -0.024684766307473183, -0.04801834374666214, -0.0954236090183258, 0.024385664612054825, -0.05132950469851494, 0.03399942070245743, 3.2013731002807617, -0.03901486098766327, 0.11516190320253372, 0.08005508780479431, 0.09174413979053497, 0.021027032285928726, 0.010418161749839783, 0.07223876565694809, -0.11567749828100204, 0.0032004821114242077, -0.04864513874053955, 0.14117293059825897, 0.07153601944446564, -0.060573894530534744, 0.1805812567472458, 0.07593462616205215, -0.0842333659529686, 0.020769942551851273, -0.10300786048173904, -0.10012879967689514, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133300>
         [1.8625516891479492, 1.8031461238861084, 1.7706787586212158, 1.7812778949737549, 1.541132926940918, 1.7607052326202393, 1.7640630006790161, 1.6652956008911133, 1.7079052925109863, 1.768364667892456, 1.8017454147338867, 1.6956119537353516, 1.6986165046691895, 1.7498118877410889, 1.8004175424575806, 1.8908579349517822, 1.7764970064163208, 1.8686726093292236, 1.7343740463256836, 0.49845606088638306, 1.8175272941589355, 1.817637324333191, 1.7590789794921875, 1.725696086883545, 1.8502297401428223, 1.6815060377120972, 1.7383397817611694, 1.7849740982055664, 1.8198825120925903, 1.7943408489227295, 1.8372061252593994, 1.6945449113845825, 1.7009174823760986, 1.7681747674942017, 1.7271453142166138, 1.7659659385681152, 1.8473800420761108, 1.7567049264907837, ...]
       >
     },
     "text_model.encoder.layers.2.self_attn.v_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133433>
         [-0.030181884765625, -0.0135650634765625, 0.01445770263671875, -0.0273284912109375, -0.015380859375, 0.04876708984375, -0.00823974609375, -0.0118865966796875, -0.021636962890625, -0.00899505615234375, 0.03826904296875, 0.041015625, -0.01910400390625, 0.041168212890625, 0.026214599609375, -0.0031642913818359375, 0.01995849609375, -0.034942626953125, 0.01155853271484375, 0.017913818359375, 0.00794219970703125, 0.0028247833251953125, 0.00560760498046875, -0.0198211669921875, 0.040130615234375, -0.0150299072265625, -0.01396942138671875, 0.021759033203125, 0.046783447265625, -0.018035888671875, 0.00205230712890625, -0.0187225341796875, 0.015716552734375, -0.0162200927734375, -0.004604339599609375, 0.025177001953125, -0.031829833984375, -0.015411376953125, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132800>
         [
           [-0.00193023681640625, -0.004261016845703125, -0.0079193115234375, -5.908012390136719e-4, -0.01513671875, -0.020721435546875, 0.01174163818359375, -0.00788116455078125, -0.00402069091796875, 0.0256195068359375, -3.006458282470703e-4, -0.0128173828125, -0.0219573974609375, 0.00954437255859375, 0.02117919921875, -0.0080108642578125, 0.00446319580078125, -0.01068878173828125, -0.02923583984375, 0.01116180419921875, -0.00556182861328125, -0.00475311279296875, -0.00452423095703125, 0.016693115234375, 0.0193634033203125, -0.006000518798828125, -0.030670166015625, 0.004680633544921875, -4.558563232421875e-4, -0.0230712890625, 0.01277923583984375, -0.0123748779296875, 0.01316070556640625, -0.0186920166015625, 0.002391815185546875, 0.00533294677734375, 0.0014390945434570312, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.11.self_attn.v_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133289>
         [0.0496826171875, 0.045684814453125, 0.04669189453125, 0.016998291015625, 0.004367828369140625, 0.11328125, 0.03277587890625, -0.0452880859375, 0.07525634765625, -0.0307464599609375, 0.0070037841796875, -0.034637451171875, 0.06060791015625, -0.00962066650390625, -0.03936767578125, 0.0032806396484375, 0.02374267578125, 0.006969451904296875, 0.00124359130859375, -0.0160369873046875, -0.056854248046875, -0.009674072265625, -0.043304443359375, -0.0025920867919921875, -0.0172882080078125, 0.02880859375, 0.00605010986328125, 0.0083160400390625, -0.018524169921875, -0.03314208984375, -0.01294708251953125, -0.00449371337890625, 0.01221466064453125, 0.0172119140625, 0.042877197265625, -0.0020580291748046875, 0.08978271484375, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132768>
         [
           [-0.004364013671875, 9.007453918457031e-4, -0.0018072128295898438, -0.038787841796875, -0.0021953582763671875, 0.0019130706787109375, 0.0143585205078125, -0.0234527587890625, 0.023040771484375, 1.9681453704833984e-4, 0.014984130859375, -0.0107269287109375, 0.0071868896484375, -0.028564453125, 0.01161956787109375, 0.01486968994140625, -0.00928497314453125, 0.01554107666015625, 0.0325927734375, 0.0269927978515625, -0.012847900390625, -0.00804901123046875, 0.0011091232299804688, -0.0166473388671875, -0.02117919921875, -0.017333984375, 0.0297698974609375, 0.0278167724609375, -0.01104736328125, -0.00316619873046875, 0.00391387939453125, -0.0259246826171875, -0.0023975372314453125, 0.058074951171875, 0.019989013671875, 0.025634765625, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.1.layer_norm2" => %{
       "beta" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133437>
         [0.10000914335250854, 0.32638785243034363, -0.21039241552352905, -0.5099883079528809, -0.04238908365368843, -0.26753100752830505, 0.9419383406639099, -0.27457013726234436, -0.5268959403038025, -0.055466145277023315, -0.2790512442588806, 0.16774171590805054, -0.38276708126068115, -0.2551422715187073, -0.6133355498313904, -0.5764642357826233, -0.22727850079536438, -0.06766527891159058, -0.5346662998199463, -2.39603328704834, -0.5109226107597351, 0.38210612535476685, -0.20304469764232635, -0.4588683843612671, -0.61575847864151, 0.070120669901371, -0.495227187871933, -0.38477984070777893, -1.0415010452270508, 0.5631952881813049, -0.20276853442192078, -0.0776149332523346, 0.3558731973171234, -0.5472927093505859, 0.2594401240348816, -0.21211189031600952, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133438>
         [1.8659831285476685, 1.7783979177474976, 1.8131226301193237, 1.903186321258545, 1.8201072216033936, 1.8358265161514282, 1.931662917137146, 1.9030423164367676, 2.0079822540283203, 1.7370694875717163, 1.9170544147491455, 1.7857252359390259, 1.9481282234191895, 1.8646926879882812, 1.9880844354629517, 1.9470396041870117, 1.9653313159942627, 1.8903632164001465, 1.9132815599441528, 2.04803466796875, 1.8217617273330688, 1.8157869577407837, 1.8040094375610352, 1.762496829032898, 1.8326023817062378, 1.8250932693481445, 1.8112444877624512, 1.8590658903121948, 2.32997465133667, 1.8212435245513916, 1.843034029006958, 1.873321294784546, 1.8304280042648315, 1.9011708498001099, 2.036221742630005, ...]
       >
     },
     "text_model.encoder.layers.11.mlp.fc2" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133279>
         [0.255859375, -0.261962890625, 0.23486328125, 0.13916015625, -0.0013599395751953125, 0.044921875, 0.11614990234375, 0.01195526123046875, -0.224609375, 0.119384765625, 0.14453125, -0.0740966796875, -0.15966796875, 0.03509521484375, -0.192138671875, 0.069091796875, -0.062347412109375, 0.0070037841796875, -0.052734375, 0.25732421875, 0.0304107666015625, -0.003215789794921875, -0.452392578125, 0.1080322265625, -0.2274169921875, -0.11322021484375, 0.03143310546875, -0.017425537109375, 0.28857421875, -0.09814453125, -0.20263671875, 0.0845947265625, 0.075927734375, -0.05078125, 0.1387939453125, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3072][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132786>
         [
           [-0.01151275634765625, 0.00920867919921875, 0.0030384063720703125, -0.00981903076171875, -0.01406097412109375, -0.020599365234375, 0.0020923614501953125, 0.016448974609375, 0.002971649169921875, -0.022735595703125, 0.0025463104248046875, 0.0032520294189453125, 0.0027008056640625, -0.0265655517578125, 0.0472412109375, -0.00811767578125, -0.0193939208984375, -0.021881103515625, 0.007450103759765625, 0.002685546875, -0.0062255859375, -0.0144805908203125, -0.010650634765625, 0.0245208740234375, 0.02960205078125, -0.0246124267578125, 0.006572723388671875, 0.0160980224609375, -0.0036487579345703125, -0.0225830078125, 0.01555633544921875, 0.00861358642578125, -0.0014257431030273438, -0.0276336669921875, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.1.mlp.fc1" => %{
       "bias" => #Nx.Tensor<
         f32[3072]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133441>
         [-0.2841796875, -0.33642578125, 0.04827880859375, -0.34814453125, -0.2357177734375, -0.458251953125, -0.425048828125, -0.365966796875, -0.3408203125, -0.35595703125, -0.4599609375, -0.267578125, -0.361328125, -0.307373046875, -0.29248046875, -0.4091796875, -0.333984375, -0.3017578125, -0.21875, -0.32861328125, -0.388916015625, -0.5224609375, -0.242431640625, -0.3740234375, -0.197021484375, -0.321533203125, -0.2420654296875, -0.237548828125, -0.07843017578125, -0.26123046875, -0.292724609375, -0.260986328125, -0.285400390625, -0.326171875, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][3072]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132808>
         [
           [0.034393310546875, -0.01004791259765625, -0.01690673828125, -0.01375579833984375, 0.0132293701171875, -0.01910400390625, 0.0035152435302734375, 0.02239990234375, 0.013916015625, -0.0022068023681640625, -0.03289794921875, -0.0095367431640625, 0.01021575927734375, 0.00970458984375, 0.0120697021484375, 0.01560211181640625, 0.003025054931640625, -0.032501220703125, 0.0181427001953125, 0.0148468017578125, -0.0028076171875, -0.00226593017578125, -0.0234222412109375, -0.0257568359375, -0.002201080322265625, 0.00824737548828125, 0.0175323486328125, -0.0121307373046875, 0.003635406494140625, 3.719329833984375e-4, 0.0263519287109375, 0.007099151611328125, -0.00455474853515625, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.1.self_attn.k_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133451>
         [0.0010776519775390625, -0.004512786865234375, 0.0022068023681640625, -9.293556213378906e-4, 0.001964569091796875, 0.00580596923828125, -0.0020275115966796875, -0.001972198486328125, 9.737014770507812e-4, -0.0016937255859375, 0.004833221435546875, -0.003597259521484375, -0.0146942138671875, 3.254413604736328e-4, 3.821849822998047e-4, 0.0079803466796875, 0.01328277587890625, -1.6164779663085938e-4, -7.891654968261719e-4, -9.088516235351562e-4, -0.00144195556640625, -0.00225830078125, -0.0020809173583984375, -0.0055999755859375, -7.328987121582031e-4, 5.846023559570312e-4, 0.0023365020751953125, 0.0032329559326171875, -0.0027446746826171875, 0.004547119140625, 5.779266357421875e-4, 0.00284576416015625, -0.0032444000244140625, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132818>
         [
           [-0.00818634033203125, -0.0025768280029296875, -0.019073486328125, 0.0401611328125, 0.0015993118286132812, 0.005878448486328125, -0.044952392578125, -0.0010290145874023438, 0.019744873046875, 0.01010894775390625, -0.009368896484375, -0.034088134765625, 8.983612060546875e-4, 0.0352783203125, 0.026275634765625, -0.004482269287109375, -0.00530242919921875, 0.01342010498046875, 0.00809478759765625, 0.04638671875, -0.03167724609375, -0.01042938232421875, -0.0152740478515625, -0.0013608932495117188, -0.00618743896484375, -0.04193115234375, -0.003185272216796875, -0.004367828369140625, -0.064697265625, 0.0031604766845703125, -0.037567138671875, -0.005344390869140625, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.9.self_attn.v_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133321>
         [-0.034912109375, -0.040985107421875, 0.031097412109375, 0.02191162109375, 0.020538330078125, -0.0027637481689453125, 0.0036792755126953125, -0.02978515625, 0.06304931640625, 0.052734375, -0.0341796875, 0.0941162109375, 0.0029087066650390625, -0.01421356201171875, -0.03564453125, -3.3974647521972656e-5, -0.026336669921875, -0.07403564453125, 0.0074005126953125, -0.0026149749755859375, -0.0189666748046875, -0.033905029296875, -0.0017242431640625, 0.01035308837890625, -0.005069732666015625, 0.01325225830078125, 0.01959228515625, -0.00797271728515625, -2.5272369384765625e-4, -0.01535797119140625, 0.003879547119140625, -0.02801513671875, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132817>
         [
           [-0.015380859375, 0.017120361328125, 0.004619598388671875, -0.00727081298828125, 0.01398468017578125, -0.00855255126953125, -0.0093994140625, -0.03155517578125, -0.01378631591796875, 0.01114654541015625, -0.003326416015625, -0.0133514404296875, -0.004695892333984375, -0.0017194747924804688, -0.0020751953125, 0.0063018798828125, 0.02862548828125, 0.006999969482421875, -0.0208282470703125, -0.0177001953125, -0.01200103759765625, 0.02227783203125, 0.0078887939453125, -0.0017137527465820312, 0.00737762451171875, 0.015625, 0.019805908203125, 0.0228729248046875, -0.01073455810546875, -0.012542724609375, -0.01739501953125, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.10.self_attn.q_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133303>
         [-0.1141357421875, 0.1932373046875, 0.1204833984375, 0.2396240234375, -0.0579833984375, 0.367919921875, -0.3896484375, 0.042449951171875, -0.0157318115234375, -0.06658935546875, 0.0225982666015625, -0.1461181640625, 0.271484375, 0.47705078125, -0.11273193359375, 0.181396484375, 0.292236328125, 0.55078125, 0.33203125, 0.399169921875, 0.62646484375, 0.201416015625, -0.150146484375, 0.1453857421875, -0.04095458984375, 0.330078125, -0.59912109375, 0.0809326171875, -0.322265625, -0.38671875, 0.100830078125, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132828>
         [
           [0.0029582977294921875, -0.0176239013671875, 0.0033092498779296875, -0.0263824462890625, -0.0224761962890625, 0.025909423828125, -0.01137542724609375, 0.03924560546875, 0.020050048828125, 0.014739990234375, 0.03564453125, -0.0287322998046875, 0.00998687744140625, -0.0190887451171875, 0.0140533447265625, -0.008270263671875, 0.0136566162109375, 0.01331329345703125, -0.04449462890625, 0.02105712890625, -0.0064697265625, -0.007007598876953125, 0.01494598388671875, -0.0158843994140625, -0.0148468017578125, -0.006977081298828125, 0.006015777587890625, -0.0173492431640625, -0.012481689453125, 0.00817108154296875, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.2.self_attn.q_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133431>
         [-0.433349609375, 0.1654052734375, -0.05194091796875, 0.2105712890625, 0.53369140625, 0.2763671875, 0.034027099609375, 0.487060546875, 0.08770751953125, 1.455078125, 0.173095703125, 0.030731201171875, 0.199462890625, -0.174072265625, 0.449462890625, -0.424560546875, -0.25732421875, 0.0943603515625, -0.2008056640625, -0.059906005859375, 0.260986328125, -0.1927490234375, -0.293701171875, 0.31787109375, 0.280517578125, 0.032073974609375, 0.329833984375, 0.01287841796875, -0.06768798828125, -1.5869140625, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132760>
         [
           [-0.033416748046875, -0.006687164306640625, -0.00801849365234375, -0.005218505859375, 0.006011962890625, 0.004177093505859375, -0.00925445556640625, 0.007808685302734375, 0.017608642578125, 0.00518035888671875, -0.0047454833984375, 0.00821685791015625, 0.036773681640625, 0.01395416259765625, 0.023040771484375, -0.0233001708984375, 0.0034160614013671875, 0.00951385498046875, 0.04327392578125, 0.0275421142578125, 0.012542724609375, 0.016845703125, 0.007427215576171875, 0.0106201171875, -0.03741455078125, -0.0166778564453125, -0.0027027130126953125, -0.0286712646484375, 0.004985809326171875, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.4.mlp.fc2" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133391>
         [0.04620361328125, 0.058441162109375, -0.0513916015625, 0.01812744140625, -0.01450347900390625, 0.11529541015625, 0.0728759765625, -0.01497650146484375, 0.051849365234375, -0.023406982421875, 0.0665283203125, 0.044891357421875, -0.0919189453125, -0.0570068359375, 0.059967041015625, 0.02032470703125, -0.0220489501953125, 0.0251007080078125, -0.02056884765625, -0.0732421875, 0.033477783203125, 0.057281494140625, -0.0098419189453125, -0.08001708984375, 0.063232421875, -0.044342041015625, -0.0132598876953125, 0.031463623046875, -0.06793212890625, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3072][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132777>
         [
           [0.0118865966796875, 0.006103515625, 0.002803802490234375, -0.0133514404296875, 0.029266357421875, 0.0181427001953125, 0.00826263427734375, -0.0347900390625, 0.006175994873046875, 0.018768310546875, -0.0149993896484375, -0.0148773193359375, -0.0208892822265625, 7.991790771484375e-4, 0.0174713134765625, -0.0172271728515625, -0.0175628662109375, -0.0269317626953125, -2.5212764739990234e-5, 0.005352020263671875, -0.0217437744140625, 0.0400390625, -0.0023593902587890625, 0.0010833740234375, -0.0018835067749023438, 0.01215362548828125, 0.0116119384765625, 0.00923919677734375, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.3.layer_norm2" => %{
       "beta" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133405>
         [-0.16344605386257172, 0.3903682827949524, -0.6572218537330627, 0.07776995003223419, -0.3644973039627075, 0.8040279150009155, 0.6369408965110779, -0.08670234680175781, -0.3817431926727295, -0.16131670773029327, -0.311787873506546, 0.5071583390235901, -0.34568458795547485, -0.5480484366416931, -0.39930322766304016, -0.01539668720215559, 0.10444637387990952, 0.0732816681265831, -0.2292013317346573, -1.6394391059875488, 0.10393620282411575, 0.48820561170578003, 0.6658700704574585, -0.5730878710746765, 0.4084419310092926, 0.17439313232898712, -0.18185114860534668, -0.07757739722728729, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133406>
         [2.0307424068450928, 1.9726213216781616, 2.0682718753814697, 2.0922024250030518, 2.090430498123169, 2.159545421600342, 2.1940205097198486, 2.094545602798462, 2.182919502258301, 2.0632195472717285, 2.0068700313568115, 2.0618984699249268, 2.024876356124878, 2.11533260345459, 2.0951507091522217, 2.0310559272766113, 2.0944907665252686, 1.9873154163360596, 2.0692670345306396, 1.320946455001831, 1.9580150842666626, 2.067638874053955, 2.08664870262146, 2.1142759323120117, 2.0650410652160645, 2.1496238708496094, 2.0864651203155518, ...]
       >
     },
     "text_model.encoder.layers.8.self_attn.out_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133333>
         [-0.032745361328125, -0.037261962890625, 0.07061767578125, -0.049407958984375, -0.08563232421875, -0.11737060546875, 0.0028247833251953125, 0.0352783203125, 0.0274810791015625, -0.07391357421875, 0.0062103271484375, -0.01515960693359375, 0.06610107421875, 0.0024585723876953125, 0.039703369140625, 0.01202392578125, 0.00824737548828125, -0.0101776123046875, 0.02850341796875, -0.08392333984375, -0.0318603515625, 0.0516357421875, 0.0265960693359375, 0.01421356201171875, 0.005374908447265625, 0.03863525390625, 0.009490966796875, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132766>
         [
           [0.0169830322265625, -4.172325134277344e-6, -0.00997161865234375, -0.0012302398681640625, 0.0362548828125, -0.0061798095703125, -0.0235748291015625, 0.0019550323486328125, -0.02777099609375, -0.00458526611328125, 0.013702392578125, -0.0016717910766601562, 0.0120086669921875, -0.0162811279296875, 0.0034236907958984375, -0.0245819091796875, 9.083747863769531e-5, -0.01117706298828125, 0.0233612060546875, -0.0026645660400390625, 0.00304412841796875, 0.00557708740234375, -0.0297393798828125, -0.016326904296875, -0.036468505859375, -0.005584716796875, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.7.self_attn.q_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133351>
         [-0.2406005859375, 0.297607421875, 0.376220703125, -0.15185546875, -0.2314453125, 0.896484375, 0.283203125, -0.1705322265625, 0.1741943359375, -0.343505859375, -0.1712646484375, -0.1663818359375, -0.318115234375, -0.01357269287109375, 0.117919921875, -0.18994140625, 0.32421875, -0.2080078125, 0.2486572265625, 0.054901123046875, -0.1495361328125, -0.0501708984375, 0.1798095703125, -0.228759765625, -0.057281494140625, 0.054351806640625, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132796>
         [
           [-0.0090179443359375, 0.00734710693359375, 0.0052947998046875, -0.0055999755859375, 0.005222320556640625, -0.00843048095703125, -0.0304107666015625, -0.017333984375, -0.002777099609375, -9.459257125854492e-5, 0.0012187957763671875, -0.0122528076171875, 0.0048828125, -0.0084228515625, -0.0159912109375, -0.0264739990234375, -0.0289306640625, -5.30242919921875e-4, -0.0035457611083984375, -0.007762908935546875, 0.0280609130859375, 0.006954193115234375, -0.003772735595703125, 0.00896453857421875, -0.00426483154296875, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.1.self_attn.v_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133449>
         [-0.01084136962890625, -0.0127410888671875, 0.01236724853515625, 0.01123809814453125, 0.026763916015625, 0.032958984375, 0.0265960693359375, -0.002132415771484375, 0.022064208984375, -0.01263427734375, 0.004627227783203125, -0.0205230712890625, 0.0041961669921875, 0.0229339599609375, 0.0292816162109375, 0.035675048828125, 0.0037784576416015625, -0.011749267578125, -0.0012254714965820312, -0.015777587890625, 0.002483367919921875, 0.007595062255859375, -0.00787353515625, 0.038604736328125, -0.00617218017578125, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132763>
         [
           [0.035308837890625, 0.0285797119140625, 0.00189971923828125, -0.0038318634033203125, -0.01358795166015625, 0.019622802734375, -0.01067352294921875, -0.0022411346435546875, -0.00493621826171875, -0.002628326416015625, -0.0095977783203125, 0.005428314208984375, -0.0182952880859375, 0.01776123046875, -0.0020389556884765625, 0.01189422607421875, -0.00119781494140625, -0.01439666748046875, -0.01165008544921875, 0.0220794677734375, 0.0185089111328125, 0.0041961669921875, 0.0079498291015625, 0.0015439987182617188, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.1.layer_norm1" => %{
       "beta" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133443>
         [0.12977191805839539, 0.03453310579061508, -0.18397828936576843, 0.012173356488347054, 0.05429041013121605, 0.07041633129119873, 0.06912524253129959, 0.06358124315738678, -0.06397067755460739, 0.022435540333390236, 0.03088977374136448, -0.02675263024866581, -0.07257647067308426, -0.011488707736134529, -0.003908276557922363, -0.02574896067380905, -0.004737242124974728, 0.03989126905798912, -0.0419897623360157, 2.929853916168213, -0.060781702399253845, 0.0011300649493932724, 0.020186923444271088, 0.0031748146284371614, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133444>
         [1.0895304679870605, 1.1491403579711914, 1.1280473470687866, 1.0221887826919556, 1.1738978624343872, 1.0663055181503296, 1.102630615234375, 1.1195870637893677, 1.0610498189926147, 1.0362197160720825, 1.0343626737594604, 1.1302334070205688, 1.1393606662750244, 1.114464521408081, 0.979293167591095, 1.2096651792526245, 1.0333894491195679, 1.2245094776153564, 1.1240818500518799, 0.27529603242874146, 1.039527177810669, 1.047205924987793, 1.16705322265625, ...]
       >
     },
     "text_model.encoder.layers.6.self_attn.q_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133367>
         [0.11993408203125, -0.1290283203125, 0.19775390625, -0.2442626953125, 0.055694580078125, -0.20654296875, 0.1270751953125, 0.2412109375, 0.095703125, 0.0738525390625, -0.1533203125, 0.30029296875, -0.517578125, 0.284423828125, -0.12359619140625, -0.274169921875, 0.0684814453125, -0.2080078125, 0.05963134765625, 1.515625, 0.344970703125, -0.2379150390625, -0.0863037109375, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132823>
         [
           [0.042022705078125, -0.02606201171875, 0.026702880859375, -0.019866943359375, -0.01340484619140625, -0.0163116455078125, -0.0193023681640625, -0.00225067138671875, -0.0097808837890625, 0.0077362060546875, -0.003879547119140625, 0.00988006591796875, -0.005268096923828125, 0.005001068115234375, -0.011688232421875, -2.104043960571289e-4, 0.0013551712036132812, -0.03912353515625, -0.033721923828125, -0.004047393798828125, -0.00428009033203125, -0.02838134765625, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.4.mlp.fc1" => %{
       "bias" => #Nx.Tensor<
         f32[3072]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133393>
         [-0.320556640625, 0.029876708984375, -0.283203125, -0.329833984375, -0.333984375, -0.055572509765625, -0.25244140625, -0.1273193359375, -0.3623046875, -0.37109375, -0.185546875, -0.318603515625, -0.1697998046875, -0.405517578125, -0.194091796875, -0.42236328125, -0.2471923828125, -0.244873046875, -0.4033203125, -0.352294921875, -0.455322265625, -0.190673828125, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][3072]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132792>
         [
           [-0.001750946044921875, -0.00605010986328125, -0.00408172607421875, 0.005428314208984375, -0.01532745361328125, -3.2019615173339844e-4, -0.01482391357421875, 0.0259246826171875, 0.026947021484375, -0.045501708984375, -0.020233154296875, -0.0029964447021484375, -0.006679534912109375, 0.03753662109375, 0.0164642333984375, -0.00292205810546875, 0.00833892822265625, 0.00617218017578125, 0.005878448486328125, -0.015655517578125, -0.002841949462890625, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.6.self_attn.k_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133371>
         [0.006336212158203125, 0.00269317626953125, -0.005702972412109375, 0.0062255859375, -0.0014438629150390625, 0.0014123916625976562, -1.742839813232422e-4, -0.0061187744140625, 0.0035457611083984375, -0.0049591064453125, 0.0017347335815429688, -0.00876617431640625, 0.032989501953125, -0.00921630859375, 0.002231597900390625, 0.006778717041015625, -0.0027923583984375, 0.0022754669189453125, 0.002838134765625, -0.05126953125, -0.006206512451171875, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132815>
         [
           [-0.035614013671875, -0.006866455078125, -0.0139312744140625, 0.029083251953125, 0.0194549560546875, 0.01145172119140625, -8.287429809570312e-4, -0.0117034912109375, 0.0235443115234375, 0.0216522216796875, 0.00530242919921875, 0.0207366943359375, -0.001708984375, 0.006969451904296875, 0.01074981689453125, 0.00623321533203125, 0.022674560546875, 0.024505615234375, 0.006725311279296875, -0.002471923828125, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.2.mlp.fc1" => %{
       "bias" => #Nx.Tensor<
         f32[3072]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133425>
         [-0.168701171875, -0.1522216796875, -0.1873779296875, -0.34521484375, -0.296630859375, -0.432861328125, -0.275146484375, -0.12890625, -0.3466796875, 0.0904541015625, -0.2159423828125, -0.1087646484375, -0.260986328125, -0.1502685546875, -0.451904296875, -0.084716796875, -0.3134765625, -0.129638671875, -0.327880859375, -0.1669921875, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][3072]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132780>
         [
           [0.0202484130859375, 0.0279388427734375, -0.01004791259765625, 0.02783203125, 0.0121307373046875, 0.04541015625, 0.01678466796875, -0.02850341796875, 0.01074981689453125, -0.003429412841796875, -0.01186370849609375, 0.004940032958984375, 0.0108489990234375, -0.01055145263671875, -0.04681396484375, 0.00360870361328125, -0.00966644287109375, 0.01427459716796875, 0.00811004638671875, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.9.layer_norm2" => %{
       "beta" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133309>
         [0.02993195131421089, -0.3016214668750763, 0.14127573370933533, -0.34645789861679077, -0.251063734292984, -0.5630080103874207, 0.2263922393321991, 0.24599701166152954, 0.16464678943157196, -0.4207763075828552, -0.12340356409549713, 0.3725084066390991, 0.12405597418546677, 0.27132871747016907, 0.031003467738628387, 0.1734217256307602, 0.1852325201034546, 0.18913431465625763, -0.1490890085697174, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133310>
         [2.5576181411743164, 2.330392599105835, 2.371114730834961, 2.397686243057251, 1.9549514055252075, 2.622178316116333, 2.4071085453033447, 2.419797658920288, 2.5432991981506348, 2.2926533222198486, 2.370722532272339, 2.448601007461548, 2.367461919784546, 2.258610725402832, 2.4002904891967773, 2.5165977478027344, 2.4092113971710205, 2.329481363296509, ...]
       >
     },
     "text_model.encoder.layers.10.mlp.fc1" => %{
       "bias" => #Nx.Tensor<
         f32[3072]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133297>
         [-0.326904296875, -0.238037109375, -0.392578125, -0.390869140625, -0.232421875, -0.313232421875, -0.10162353515625, -0.237548828125, -0.259033203125, -0.2449951171875, -0.302001953125, -0.2406005859375, -0.243408203125, -0.292724609375, -0.257568359375, -0.28955078125, -0.30029296875, -0.37353515625, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][3072]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132797>
         [
           [-0.019287109375, -0.0300750732421875, -0.0015516281127929688, 0.0183563232421875, 0.00376129150390625, -0.006694793701171875, -0.00255584716796875, -0.00807952880859375, 0.01425933837890625, -0.0120697021484375, 0.020751953125, 0.03997802734375, -0.0212554931640625, 0.010833740234375, -0.01544952392578125, -0.0035724639892578125, -0.005214691162109375, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.3.self_attn.q_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133415>
         [0.1748046875, -0.0694580078125, -0.2498779296875, -0.2509765625, 0.2392578125, -0.20263671875, 0.018096923828125, 0.1644287109375, 0.408203125, 0.31005859375, 0.0200653076171875, 0.267822265625, -1.0078125, -0.3515625, 0.373291015625, 1.083984375, 0.366943359375, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132789>
         [
           [-0.0185546875, 0.030487060546875, 0.0020389556884765625, 0.0299835205078125, -0.0218658447265625, 0.010406494140625, 0.0161895751953125, -0.006549835205078125, 0.0148773193359375, 0.055328369140625, -0.03607177734375, 0.0016489028930664062, 0.0202178955078125, -0.0186004638671875, 0.00429534912109375, -0.0182342529296875, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.0.layer_norm2" => %{
       "beta" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133453>
         [-0.28833821415901184, 0.678752064704895, -0.23783431947231293, 0.725416898727417, 0.503646731376648, -0.10250460356473923, -0.39273232221603394, 0.7608547806739807, 0.2821524739265442, 0.27521589398384094, 0.6369630098342896, 0.035316985100507736, 0.5877634882926941, -0.08920148015022278, -0.2473406344652176, 0.2363470196723938, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133454>
         [1.5466058254241943, 1.6286697387695312, 1.4619557857513428, 1.5152413845062256, 1.6963239908218384, 1.535176396369934, 1.70278799533844, 1.6495012044906616, 1.6754218339920044, 1.544610857963562, 1.7197632789611816, 1.6647281646728516, 1.7216570377349854, 1.7012755870819092, 1.5660526752471924, ...]
       >
     },
     "text_model.encoder.layers.9.layer_norm1" => %{
       "beta" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133315>
         [0.1347765326499939, 0.04949744790792465, -0.19917109608650208, -0.02518429048359394, 0.18369072675704956, 0.14607281982898712, 0.14084140956401825, 0.06852789968252182, -0.15947498381137848, -0.06220719590783119, 0.07612086832523346, 0.0032098141964524984, -0.18939539790153503, -0.04390576854348183, -0.1292201578617096, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133316>
         [1.6301889419555664, 1.7984678745269775, 1.6645803451538086, 1.6735960245132446, 1.624648928642273, 1.74346923828125, 1.6343638896942139, 1.595078706741333, 1.7834960222244263, 1.7150965929031372, 1.7555060386657715, 1.739649772644043, 1.7074795961380005, 1.6980540752410889, ...]
       >
     },
     "text_model.encoder.layers.6.mlp.fc1" => %{
       "bias" => #Nx.Tensor<
         f32[3072]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133361>
         [-0.295654296875, -0.329345703125, -0.347900390625, -0.25390625, -0.33740234375, -0.35302734375, -0.353759765625, -0.33837890625, -0.301513671875, -0.347900390625, -0.433349609375, -0.423828125, -0.28564453125, -0.245361328125, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][3072]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132762>
         [
           [-0.004772186279296875, 0.0113677978515625, -0.0232086181640625, -0.002925872802734375, 0.007472991943359375, -7.929801940917969e-4, -0.010772705078125, 0.0014448165893554688, 0.0011701583862304688, 0.01399993896484375, -0.0288543701171875, 0.0193634033203125, -0.01245880126953125, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.4.self_attn.out_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133397>
         [-0.004512786865234375, 0.0010890960693359375, -0.033477783203125, -0.01271820068359375, -0.06707763671875, 0.067138671875, 0.0687255859375, -0.015411376953125, 0.040191650390625, 0.03326416015625, 0.0280303955078125, -0.017822265625, -0.05035400390625, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132774>
         [
           [0.0032634735107421875, -0.0088043212890625, -0.00318145751953125, -0.0089111328125, 0.0125885009765625, 0.0023555755615234375, -0.01371002197265625, -0.00336456298828125, 0.0095062255859375, -0.0174713134765625, -0.012115478515625, 0.007625579833984375, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.10.self_attn.v_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133305>
         [0.0296478271484375, 0.02142333984375, -0.0258026123046875, 0.01959228515625, 0.01284027099609375, -0.047119140625, 0.0230712890625, -0.036468505859375, -0.0150604248046875, 0.1173095703125, 0.01300048828125, 0.033935546875, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132764>
         [
           [0.0172882080078125, 0.005748748779296875, 0.006496429443359375, -0.00801849365234375, 0.004047393798828125, 0.0205535888671875, 0.004611968994140625, 0.026519775390625, -0.004756927490234375, 0.0198211669921875, 0.01546478271484375, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.4.layer_norm2" => %{
       "beta" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133389>
         [-0.4047391712665558, 0.5040913224220276, -0.6209463477134705, 0.19046032428741455, -0.931059718132019, 0.436679482460022, 0.6278329491615295, -0.007896539755165577, -0.8558846116065979, -0.30262842774391174, -0.600728452205658, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133390>
         [2.148181915283203, 2.076059103012085, 2.1921045780181885, 2.0451087951660156, 2.038395643234253, 2.143629312515259, 2.270378828048706, 2.1226789951324463, 2.1464669704437256, 2.189829111099243, ...]
       >
     },
     "text_model.encoder.layers.5.self_attn.k_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133387>
         [-0.00351715087890625, 0.002033233642578125, 0.0019683837890625, 1.4901161193847656e-5, 0.0022792816162109375, -0.0013027191162109375, -0.0023708343505859375, 0.0025196075439453125, -4.496574401855469e-4, 0.004119873046875, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132779>
         [
           [0.0068511962890625, 0.01715087890625, -0.0218048095703125, 0.0013628005981445312, -0.0033779144287109375, 0.002399444580078125, -0.0147705078125, -0.0215606689453125, -6.21795654296875e-4, ...],
           ...
         ]
       >
     },
     "text_model.embeddings.position_embedding" => %{
       "kernel" => #Nx.Tensor<
         f32[77][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132748>
         [
           [0.0015836182283237576, 0.002009103773161769, 2.0798639161512256e-4, -0.0018741367384791374, -7.062330259941518e-4, 0.0029947920702397823, 6.328017916530371e-4, -0.002918598474934697, 0.0018473686650395393, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.9.mlp.fc1" => %{
       "bias" => #Nx.Tensor<
         f32[3072]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133313>
         [-0.23876953125, -0.362548828125, -0.0865478515625, -0.2469482421875, -0.38671875, -0.24853515625, -0.222412109375, -0.3095703125, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][3072]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132795>
         [
           [0.0171051025390625, -0.036407470703125, -0.011260986328125, -0.00252532958984375, -0.0038356781005859375, 0.0124664306640625, -0.0173797607421875, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.0.mlp.fc2" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133455>
         [0.00778961181640625, -0.0325927734375, 0.0023365020751953125, -0.002742767333984375, -0.017852783203125, -0.036956787109375, 0.043548583984375, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3072][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132775>
         [
           [-9.469985961914062e-4, 7.100105285644531e-4, 0.001316070556640625, 0.0033245086669921875, -0.00390625, -0.027740478515625, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.7.mlp.fc2" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133343>
         [0.04400634765625, 0.04400634765625, -0.04034423828125, 0.0782470703125, 0.003208160400390625, -0.006916046142578125, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3072][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132772>
         [
           [0.017181396484375, 0.016448974609375, -0.0011148452758789062, 0.0026760101318359375, -0.005130767822265625, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.3.mlp.fc2" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133407>
         [-0.01406097412109375, 0.056396484375, -0.06365966796875, -0.015655517578125, -0.07012939453125, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3072][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132819>
         [
           [0.005645751953125, 0.002288818359375, -0.0023593902587890625, 0.007762908935546875, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.10.self_attn.k_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133307>
         [8.292198181152344e-4, 0.0020046234130859375, -0.006412506103515625, 0.0024089813232421875, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132822>
         [
           [0.027252197265625, 0.0311431884765625, -0.0124359130859375, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.7.layer_norm2" => %{
       "beta" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133341>
         [0.16211451590061188, 0.13201956450939178, -0.8621279001235962, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133342>
         [2.2640023231506348, 2.1569459438323975, ...]
       >
     },
     "text_model.encoder.layers.10.self_attn.out_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133301>
         [-0.10736083984375, 0.10443115234375, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132773>
         [
           [-0.0027923583984375, ...],
           ...
         ]
       >
     },
     "text_model.encoder.layers.11.self_attn.q_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133287>
         [0.17138671875, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[768][768]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132798>
         [
           ...
         ]
       >
     },
     "text_model.encoder.layers.9.self_attn.q_proj" => %{
       "bias" => #Nx.Tensor<
         f32[768]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133319>
         [...]
       >,
       ...
     },
     "text_model.encoder.layers.3.layer_norm1" => %{...},
     ...
   },
   spec: %Bumblebee.Text.ClipText{
     architecture: :base,
     vocab_size: 49408,
     max_positions: 77,
     hidden_size: 768,
     num_blocks: 12,
     num_attention_heads: 12,
     intermediate_size: 3072,
     activation: :quick_gelu,
     attention_dropout_rate: 0.0,
     layer_norm_epsilon: 1.0e-5,
     output_hidden_states: false,
     output_attentions: false,
     num_labels: 2,
     id_to_label: %{},
     pad_token_id: 1,
     bos_token_id: 0,
     eos_token_id: 2
   }
 }}
```

```elixir
{:ok, vae} =
  Bumblebee.load_model({:hf, repository_id, subdir: "vae"},
    architecture: :decoder,
    params_filename: "diffusion_pytorch_model.bin"
  )
```

<!-- livebook:{"output":true} -->

```

01:06:36.059 [debug] the following PyTorch parameters were unused:

  * encoder.conv_in.bias
  * encoder.conv_in.weight
  * encoder.conv_norm_out.bias
  * encoder.conv_norm_out.weight
  * encoder.conv_out.bias
  * encoder.conv_out.weight
  * encoder.down_blocks.0.downsamplers.0.conv.bias
  * encoder.down_blocks.0.downsamplers.0.conv.weight
  * encoder.down_blocks.0.resnets.0.conv1.bias
  * encoder.down_blocks.0.resnets.0.conv1.weight
  * encoder.down_blocks.0.resnets.0.conv2.bias
  * encoder.down_blocks.0.resnets.0.conv2.weight
  * encoder.down_blocks.0.resnets.0.norm1.bias
  * encoder.down_blocks.0.resnets.0.norm1.weight
  * encoder.down_blocks.0.resnets.0.norm2.bias
  * encoder.down_blocks.0.resnets.0.norm2.weight
  * encoder.down_blocks.0.resnets.1.conv1.bias
  * encoder.down_blocks.0.resnets.1.conv1.weight
  * encoder.down_blocks.0.resnets.1.conv2.bias
  * encoder.down_blocks.0.resnets.1.conv2.weight
  * encoder.down_blocks.0.resnets.1.norm1.bias
  * encoder.down_blocks.0.resnets.1.norm1.weight
  * encoder.down_blocks.0.resnets.1.norm2.bias
  * encoder.down_blocks.0.resnets.1.norm2.weight
  * encoder.down_blocks.1.downsamplers.0.conv.bias
  * encoder.down_blocks.1.downsamplers.0.conv.weight
  * encoder.down_blocks.1.resnets.0.conv1.bias
  * encoder.down_blocks.1.resnets.0.conv1.weight
  * encoder.down_blocks.1.resnets.0.conv2.bias
  * encoder.down_blocks.1.resnets.0.conv2.weight
  * encoder.down_blocks.1.resnets.0.conv_shortcut.bias
  * encoder.down_blocks.1.resnets.0.conv_shortcut.weight
  * encoder.down_blocks.1.resnets.0.norm1.bias
  * encoder.down_blocks.1.resnets.0.norm1.weight
  * encoder.down_blocks.1.resnets.0.norm2.bias
  * encoder.down_blocks.1.resnets.0.norm2.weight
  * encoder.down_blocks.1.resnets.1.conv1.bias
  * encoder.down_blocks.1.resnets.1.conv1.weight
  * encoder.down_blocks.1.resnets.1.conv2.bias
  * encoder.down_blocks.1.resnets.1.conv2.weight
  * encoder.down_blocks.1.resnets.1.norm1.bias
  * encoder.down_blocks.1.resnets.1.norm1.weight
  * encoder.down_blocks.1.resnets.1.norm2.bias
  * encoder.down_blocks.1.resnets.1.norm2.weight
  * encoder.down_blocks.2.downsamplers.0.conv.bias
  * encoder.down_blocks.2.downsamplers.0.conv.weight
  * encoder.down_blocks.2.resnets.0.conv1.bias
  * encoder.down_blocks.2.resnets.0.conv1.weight
  * encoder.down_blocks.2.resnets.0.conv2.bias
  * encoder.down_blocks.2.resnets.0.conv2.weight
  * encoder.down_blocks.2.resnets.0.conv_shortcut.bias
  * encoder.down_blocks.2.resnets.0.conv_shortcut.weight
  * encoder.down_blocks.2.resnets.0.norm1.bias
  * encoder.down_blocks.2.resnets.0.norm1.weight
  * encoder.down_blocks.2.resnets.0.norm2.bias
  * encoder.down_blocks.2.resnets.0.norm2.weight
  * encoder.down_blocks.2.resnets.1.conv1.bias
  * encoder.down_blocks.2.resnets.1.conv1.weight
  * encoder.down_blocks.2.resnets.1.conv2.bias
  * encoder.down_blocks.2.resnets.1.conv2.weight
  * encoder.down_blocks.2.resnets.1.norm1.bias
  * encoder.down_blocks.2.resnets.1.norm1.weight
  * encoder.down_blocks.2.resnets.1.norm2.bias
  * encoder.down_blocks.2.resnets.1.norm2.weight
  * encoder.down_blocks.3.resnets.0.conv1.bias
  * encoder.down_blocks.3.resnets.0.conv1.weight
  * encoder.down_blocks.3.resnets.0.conv2.bias
  * encoder.down_blocks.3.resnets.0.conv2.weight
  * encoder.down_blocks.3.resnets.0.norm1.bias
  * encoder.down_blocks.3.resnets.0.norm1.weight
  * encoder.down_blocks.3.resnets.0.norm2.bias
  * encoder.down_blocks.3.resnets.0.norm2.weight
  * encoder.down_blocks.3.resnets.1.conv1.bias
  * encoder.down_blocks.3.resnets.1.conv1.weight
  * encoder.down_blocks.3.resnets.1.conv2.bias
  * encoder.down_blocks.3.resnets.1.conv2.weight
  * encoder.down_blocks.3.resnets.1.norm1.bias
  * encoder.down_blocks.3.resnets.1.norm1.weight
  * encoder.down_blocks.3.resnets.1.norm2.bias
  * encoder.down_blocks.3.resnets.1.norm2.weight
  * encoder.mid_block.attentions.0.group_norm.bias
  * encoder.mid_block.attentions.0.group_norm.weight
  * encoder.mid_block.attentions.0.key.bias
  * encoder.mid_block.attentions.0.key.weight
  * encoder.mid_block.attentions.0.proj_attn.bias
  * encoder.mid_block.attentions.0.proj_attn.weight
  * encoder.mid_block.attentions.0.query.bias
  * encoder.mid_block.attentions.0.query.weight
  * encoder.mid_block.attentions.0.value.bias
  * encoder.mid_block.attentions.0.value.weight
  * encoder.mid_block.resnets.0.conv1.bias
  * encoder.mid_block.resnets.0.conv1.weight
  * encoder.mid_block.resnets.0.conv2.bias
  * encoder.mid_block.resnets.0.conv2.weight
  * encoder.mid_block.resnets.0.norm1.bias
  * encoder.mid_block.resnets.0.norm1.weight
  * encoder.mid_block.resnets.0.norm2.bias
  * encoder.mid_block.resnets.0.norm2.weight
  * encoder.mid_block.resnets.1.conv1.bias
  * encoder.mid_block.resnets.1.conv1.weight
  * encoder.mid_block.resnets.1.conv2.bias
  * encoder.mid_block.resnets.1.conv2.weight
  * encoder.mid_block.resnets.1.norm1.bias
  * encoder.mid_block.resnets.1.norm1.weight
  * encoder.mid_block.resnets.1.norm2.bias
  * encoder.mid_block.resnets.1.norm2.weight
  * quant_conv.bias
  * quant_conv.weight


```

<!-- livebook:{"output":true} -->

```
{:ok,
 %{
   model: #Axon<
     inputs: %{"sample" => {nil, 85, 85, 4}}
     outputs: "container_15"
     nodes: 173
   >,
   params: %{
     "decoder.mid_block.resnets.0.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133507>
         [0.0803266316652298, -0.059336453676223755, -0.03488972783088684, -0.16086582839488983, -0.030558809638023376, -0.0782947912812233, -0.006943208165466785, -0.007067279424518347, -0.11685685068368912, -0.01601431705057621, -0.07695819437503815, -0.06893973797559738, -0.20152460038661957, 0.03642972558736801, -0.16713492572307587, 0.06715159118175507, -0.05399905890226364, -0.08014418184757233, -0.0024267795961350203, -0.058559030294418335, -0.3029145300388336, -0.10670205950737, -0.18206563591957092, -0.2512587010860443, -0.04201522842049599, -0.03655396029353142, -0.033166006207466125, -0.028937261551618576, -0.1503136307001114, -0.055811990052461624, -0.04561648145318031, -0.010159553959965706, -0.09636051952838898, -0.13744154572486877, 0.11292721331119537, -0.004522884730249643, -0.08989135921001434, -0.1525457501411438, -0.08102703094482422, -0.051217202097177505, -0.1358519345521927, -0.16973505914211273, -0.09190015494823456, -0.0459011048078537, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133508>
         [1.1444385051727295, 1.073317527770996, 1.1156432628631592, 0.9750732779502869, 0.9981518387794495, 0.992546796798706, 1.1989789009094238, 1.245538592338562, 0.9897987842559814, 1.2322869300842285, 1.0632911920547485, 1.1049696207046509, 0.7218558192253113, 1.130449652671814, 1.0815849304199219, 1.313871145248413, 0.9735518097877502, 1.159682035446167, 1.1169968843460083, 0.9119717478752136, 0.8687658309936523, 1.0053750276565552, 0.890943169593811, 0.8617886900901794, 1.1998790502548218, 1.0771493911743164, 1.2564973831176758, 1.0387321710586548, 0.895699143409729, 1.1369799375534058, 1.2529205083847046, 1.1423901319503784, 1.2131589651107788, 0.9094467759132385, 1.211183786392212, 0.9967013597488403, 1.110451579093933, 1.0601261854171753, 0.8276579976081848, 0.9394102096557617, 0.896489143371582, 0.8700560331344604, 0.8919849991798401, ...]
       >
     },
     "decoder.up_blocks.3.resnets.0.conv2" => %{
       "bias" => #Nx.Tensor<
         f32[128]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133537>
         [-0.01557117234915495, 0.018230225890874863, 0.014582273550331593, 0.007860446348786354, -0.08251525461673737, 0.057150766253471375, 0.026479966938495636, -0.006320089567452669, -0.03927791863679886, 0.02307768538594246, -0.01820792630314827, 0.06465528905391693, 0.011364651843905449, 0.0314866304397583, 0.005150383338332176, 0.008935120888054371, 0.008840473368763924, -0.020980462431907654, 0.022087357938289642, 0.011005719192326069, 0.015555841848254204, 0.036835234612226486, -0.02877066098153591, -0.0038159224204719067, 0.031486254185438156, -0.05631532520055771, -0.02533777616918087, 0.0491163469851017, -0.011899962089955807, 0.003782493993639946, 0.0017112491186708212, 0.011964998207986355, -0.06612713634967804, 0.05664438009262085, 0.040068138390779495, 0.03080570138990879, 0.03948161005973816, -0.008910080417990685, 0.05120657756924629, -0.007677492219954729, 0.008391284383833408, -0.04134639352560043, -0.0155074717476964, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][128][128]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132940>
         [
           [
             [
               [0.04179646447300911, -0.026934539899230003, -0.0014378479681909084, -0.014071213081479073, -0.07484448701143265, -0.013674573041498661, 0.03354235738515854, 0.007017973344773054, -0.021113375201821327, 0.02458677999675274, -0.024365946650505066, -0.0292312391102314, -0.010055814869701862, -0.064238041639328, -0.03066740371286869, 0.028618786484003067, 0.007032135035842657, -0.06789752095937729, -0.01470641978085041, -0.03343283385038376, -0.012951519340276718, 0.04356483742594719, -0.07666170597076416, -0.037978462874889374, 0.006885136943310499, -0.035382818430662155, 0.04677116498351097, 0.027354618534445763, -0.01829565316438675, -0.002106639090925455, -0.04321419820189476, -0.07319937646389008, -0.01261872984468937, 0.050045400857925415, -6.770238396711648e-4, -0.0020951530896127224, 0.0369565449655056, -0.08329298347234726, 0.0382990762591362, 0.05074425786733627, -0.033293381333351135, -0.002390931360423565, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.3.resnets.2.conv2" => %{
       "bias" => #Nx.Tensor<
         f32[128]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133519>
         [0.032964251935482025, -0.029580960050225258, -0.018399516120553017, 0.003858860582113266, -0.053470466285943985, 0.04646139591932297, 0.03280579298734665, -0.0011107228929176927, -0.05741552636027336, 0.010289219208061695, 2.0233159375493415e-5, 0.05091312900185585, -0.004722192417830229, 0.033610809594392776, -0.002934826537966728, -0.028838949277997017, 0.0025055697187781334, -0.00622161291539669, 0.04339440166950226, 0.003926179837435484, -6.204629899002612e-4, -0.004649454262107611, -0.021991942077875137, -0.025825362652540207, 0.026378493756055832, -0.00145240337587893, -0.05212145671248436, 0.04727403074502945, -0.010083097964525223, -0.007081974763423204, -0.012960518710315228, 0.06535405665636063, -0.015496707521378994, 0.0031197776552289724, -0.0057170516811311245, 0.024719543755054474, -0.006280760746449232, -0.020923001691699028, 0.0037368442863225937, 0.03672420233488083, 0.007484286557883024, 0.005364015698432922, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][128][128]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132936>
         [
           [
             [
               [-0.05985071882605553, 0.0069567300379276276, -0.12896598875522614, 0.07218500971794128, 0.08005136996507645, 0.04596038907766342, -0.01830889843404293, -0.051682036370038986, -0.03111058846116066, 0.01606575772166252, -0.0034824577160179615, -0.011341736651957035, -0.03754987195134163, 0.08241740614175797, -9.768910240381956e-5, 0.0347103551030159, -0.04695301502943039, -0.011294616386294365, -0.004172213841229677, 0.009317485615611076, -0.011697817593812943, -0.047364309430122375, -0.018344292417168617, 0.03736107051372528, -0.048957422375679016, 0.014103567227721214, 0.03297746554017067, -0.1114911139011383, -0.12291209399700165, 0.02188222110271454, -0.023390674963593483, 0.06007828563451767, 0.0018738450016826391, -0.014857590198516846, -0.027591921389102936, -0.0013159953523427248, -0.03508469834923744, -0.033879753202199936, -0.14516142010688782, -0.011099420487880707, 0.15963491797447205, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.1.resnets.0.conv1" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133595>
         [0.024651847779750824, 0.013225974515080452, -0.00625250581651926, 0.017134392634034157, 0.03636658564209938, 0.021942254155874252, 0.0553751178085804, 0.014686588197946548, 0.005394637584686279, 0.0404132641851902, 0.06002171337604523, 0.022908890619874, 0.038587771356105804, 0.03141450136899948, 0.0020370830316096544, 0.029148917645215988, 0.011714272201061249, 0.05842117965221405, -0.003529855515807867, 0.048555612564086914, 0.012909933924674988, 0.061020929366350174, 0.0178030077368021, 0.035021405667066574, 0.012109329923987389, 0.01636708527803421, 0.05616791546344757, 0.041790131479501724, 0.06844720244407654, 0.07697074115276337, -0.028520949184894562, 0.010166372172534466, 0.05084496736526489, 0.10412287712097168, 0.005912207532674074, 0.057456035166978836, 0.05624791979789734, 0.08158475905656815, -0.008156446740031242, -0.029204411432147026, 0.07028592377901077, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][512][512]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132934>
         [
           [
             [
               [-0.012516326270997524, -0.05925890803337097, -0.02816937305033207, 0.018505020067095757, 0.0014983211876824498, 0.025396866723895073, 0.031870778650045395, 0.040293414145708084, 0.07528559863567352, -0.0034165997058153152, -0.01549837552011013, 0.04820684716105461, 0.04876051843166351, 0.022798288613557816, 0.023558398708701134, -0.015128101222217083, -0.03237646073102951, -0.022976016625761986, -0.00831498485058546, 0.02121327817440033, 9.079183801077306e-4, -0.018972406163811684, 0.014505293220281601, -0.02506084553897381, 0.08087841421365738, -0.0111788809299469, -0.04807273671030998, 0.0027190709952265024, -0.0019442016491666436, 0.054155878722667694, -0.029626263305544853, -0.012011125683784485, -0.018206913024187088, 0.021055245772004128, 0.02592320926487446, -0.006315464153885841, -0.02427927777171135, 0.001744008157402277, 0.02005847729742527, 0.020093649625778198, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.3.resnets.0.norm2" => %{
       "beta" => #Nx.Tensor<
         f32[128]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133539>
         [0.054100021719932556, 0.07378239929676056, 0.011707136407494545, 0.049590982496738434, -0.1420792043209076, -0.13090234994888306, 0.04028216376900673, -0.16996262967586517, 0.007578154094517231, -0.04162997379899025, 0.015395321883261204, -0.07258240878582001, 0.03778161108493805, -0.08117768168449402, -0.07890921086072922, -0.04590915888547897, 0.09035418927669525, 0.10451297461986542, -0.0026901052333414555, -0.014069556258618832, -0.05306503549218178, 0.014231220819056034, 0.02292599529027939, -0.034194160252809525, 0.038511235266923904, 0.005169027019292116, 0.029311368241906166, -0.058212634176015854, -0.04114338755607605, -0.03746720403432846, -0.0335649698972702, -0.10532715916633606, -0.052699923515319824, 0.03035343438386917, 0.1149885430932045, -0.01598476618528366, -0.017412317916750908, -0.02498050034046173, -0.02698354795575142, -0.012793597765266895, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[128]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133540>
         [1.3608078956604004, 1.3210121393203735, 1.2509469985961914, 1.2101083993911743, 1.4334051609039307, 1.5203607082366943, 1.188890814781189, 1.5631589889526367, 1.0719482898712158, 1.0569988489151, 1.4708589315414429, 1.0510305166244507, 1.2225183248519897, 1.3626673221588135, 1.340580940246582, 1.2682603597640991, 1.1294548511505127, 1.21800696849823, 1.241315245628357, 1.2031786441802979, 1.080833911895752, 1.2846219539642334, 1.163453221321106, 1.494149923324585, 1.0937409400939941, 1.1034340858459473, 1.0850509405136108, 1.198896050453186, 1.1615318059921265, 1.4602500200271606, 1.1863206624984741, 1.4029457569122314, 1.11146879196167, 1.2635226249694824, 1.1691986322402954, 1.2319252490997314, 1.0421900749206543, 1.059698462486267, 1.0533109903335571, ...]
       >
     },
     "decoder.mid_block.resnets.0.conv2" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133501>
         [-0.0252932570874691, 0.005791218485683203, 0.007561785168945789, 0.009959171526134014, 0.005610031075775623, 0.0036991082597523928, 0.03395165875554085, 0.013475963845849037, -0.016689596697688103, 0.04370874539017677, -0.0017320726765319705, 0.033290572464466095, -0.004357815720140934, -0.002798241563141346, -0.018485981971025467, -0.021365204825997353, 0.017478054389357567, 0.017353050410747528, -0.006544968578964472, 0.035249218344688416, -0.029477814212441444, 0.020802926272153854, -0.02234191633760929, 0.006963066756725311, 0.048008207231760025, 0.027629893273115158, -0.011103555560112, -0.010065419599413872, 0.05104302987456322, 0.0018764605047181249, -0.03277796506881714, 0.0031303910072892904, -0.030694127082824707, -0.01142598781734705, 0.04634592682123184, 0.015184091404080391, 0.004447442013770342, -0.022453341633081436, 0.020639948546886444, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][512][512]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132967>
         [
           [
             [
               [-0.008877345360815525, -0.010201439261436462, -0.005590352695435286, 0.023125652223825455, 0.036850132048130035, -1.515841722721234e-4, -0.003105982206761837, 0.023198099806904793, 0.030373668298125267, -0.034870270639657974, -0.0035104050766676664, -0.035388484597206116, 0.03598666563630104, 0.031723566353321075, -0.017775455489754677, -0.016758082434535027, -0.019492225721478462, 0.015891363844275475, -0.03981959447264671, 0.01693626120686531, -0.001710272510536015, 0.055780135095119476, 0.005357653368264437, -0.0039606718346476555, -0.006564147304743528, 0.014192210510373116, -0.012734557501971722, 0.03588246554136276, -0.006344107910990715, 0.026382938027381897, -0.0019255158258602023, -0.003285794984549284, 0.031196096912026405, -0.010942738503217697, 0.052861716598272324, 0.00484091741964221, -0.01781531423330307, -0.059414204210042953, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.2.resnets.0.conv2" => %{
       "bias" => #Nx.Tensor<
         f32[256]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133565>
         [0.06821569800376892, 0.03454874828457832, -0.03155890107154846, 0.014926069416105747, 0.02353806234896183, 0.062167730182409286, 0.010991514660418034, -0.012910816818475723, 0.0738958939909935, 0.022423628717660904, 0.035904403775930405, -0.01460186392068863, 0.06485357135534286, 0.05748751014471054, -0.02598443068563938, 0.02554161101579666, -0.00675905542448163, 0.016013415530323982, 0.04469896852970123, -0.006029284093528986, 0.049577441066503525, 0.024422524496912956, 0.05711906775832176, 0.04810626804828644, 0.04971596598625183, 0.023140162229537964, -0.013355353847146034, -0.017625972628593445, 0.03965326026082039, -0.0021091769449412823, 0.007189317140728235, -0.04461134970188141, -0.00574445677921176, 0.06232545152306557, 0.028562430292367935, 0.016618462279438972, -0.06903162598609924, -0.02208973839879036, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][256][256]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132942>
         [
           [
             [
               [0.015978064388036728, 0.0023935018107295036, -0.019195556640625, 0.049212563782930374, -0.01460877712816, 0.007788903545588255, 0.09747778624296188, 0.002969038672745228, -0.019588813185691833, -0.006941399537026882, 0.002107311738654971, 0.08494441956281662, 0.00571833923459053, -0.04309073090553284, 0.04891302064061165, -0.012010852806270123, 0.0420897975564003, -0.008170111104846, -0.0073194345459342, 0.047137998044490814, 9.769153548404574e-4, -0.021804479882121086, 0.05325068533420563, 0.01732335053384304, -0.06619199365377426, -0.046042341738939285, -0.041058000177145004, -0.0192702766507864, -0.05264333635568619, 0.027579335495829582, 0.01020067185163498, 0.007781227584928274, -0.04719582200050354, 0.024553926661610603, 0.00471987621858716, -0.0453314445912838, 0.008248192258179188, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.0.resnets.0.conv2" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133617>
         [-0.009454005397856236, 0.023093976080417633, -0.032759591937065125, -0.027507124468684196, 0.0233173631131649, 0.0689346119761467, -0.010434040799736977, 0.06957805156707764, 0.0353790819644928, 0.052598513662815094, 0.04725691303610802, 0.011884906329214573, 0.015938429161906242, -0.02499215491116047, 0.0770382359623909, -0.04689330607652664, 0.04444169998168945, 0.026280023157596588, 0.01920901983976364, 0.01973046362400055, 0.013682612217962742, -0.00443296879529953, 0.04040457680821419, 0.018919166177511215, 0.04783768206834793, 0.020740235224366188, -0.02885100618004799, -0.008997035212814808, 0.021495824679732323, -0.015439610928297043, 0.0013370600063353777, 0.0026015397161245346, 0.018227195367217064, -0.0047593628987669945, -0.018424808979034424, -0.01802576333284378, 0.0054441578686237335, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][512][512]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132947>
         [
           [
             [
               [-0.059229228645563126, 0.013577240519225597, -0.014701024629175663, -0.03413791209459305, 0.02461019903421402, 0.01926165260374546, -0.009429101832211018, -0.013422518968582153, -0.011534953489899635, -8.190898806788027e-4, -0.01201410498470068, -0.020385487005114555, -0.019006310030817986, -0.09922290593385696, -0.0053640929982066154, 0.015587013214826584, -0.06914962083101273, 0.004700357094407082, 0.0032832736615091562, -0.006425254046916962, 0.03153486177325249, -0.0178579930216074, 0.02390364184975624, -0.0606132335960865, 0.006481709890067577, 0.0071859052404761314, 0.016170917078852654, -0.02772992104291916, -0.010631229728460312, -0.006714083719998598, 0.002004047855734825, -0.018605127930641174, 0.004378035198897123, 0.024613572284579277, -0.026463042944669724, -0.01787515915930271, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.3.resnets.2.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[128]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133525>
         [-0.026844171807169914, -0.006076454650610685, -0.10020802170038223, -0.15360736846923828, -0.051525767892599106, -0.03036215528845787, -0.007195081561803818, -0.012777231633663177, 0.06785276532173157, -0.079952172935009, -0.054575368762016296, -0.017232311889529228, -0.04355932027101517, -0.03048555739223957, -0.052310071885585785, -0.019086673855781555, -0.08341474831104279, 0.005592709872871637, -0.06013520434498787, -0.013040956109762192, -0.00553986756131053, -0.004779738374054432, -0.0600631944835186, 0.016164395958185196, -0.033481597900390625, -0.13291354477405548, 0.027791688218712807, -0.07747040688991547, 0.03638988733291626, -0.06959127634763718, -0.07368423044681549, -0.07356127351522446, -0.06188679486513138, -0.013011383824050426, -0.07791310548782349, 0.04825727269053459, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[128]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133526>
         [0.9368351697921753, 1.0285365581512451, 0.9423020482063293, 0.92781662940979, 1.0556577444076538, 0.9404362440109253, 1.0296034812927246, 0.9530892968177795, 0.9205964207649231, 0.9370479583740234, 0.9635645151138306, 0.9116508364677429, 1.0075761079788208, 1.0707530975341797, 0.9930511713027954, 1.0913892984390259, 1.0056041479110718, 1.089909553527832, 0.9872509241104126, 1.0252381563186646, 0.9918496608734131, 0.9614315032958984, 0.9795559644699097, 0.9674647450447083, 0.8491381406784058, 0.9422431588172913, 0.9099160432815552, 0.8945994973182678, 0.9666586518287659, 0.9563695788383484, 0.9525250196456909, 1.0284912586212158, 0.960953414440155, 0.9393125772476196, 0.9475532174110413, ...]
       >
     },
     "decoder.mid_block.resnets.0.norm2" => %{
       "beta" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133503>
         [-0.24800273776054382, -0.46303120255470276, -0.2801745533943176, -0.2712123394012451, -0.4802692234516144, -0.43854930996894836, -0.2806147038936615, -0.20791281759738922, -0.4374414086341858, -0.2871834635734558, -0.21262186765670776, -0.4631566107273102, -0.237204447388649, -0.22263774275779724, -0.32705479860305786, -0.22144605219364166, -0.3565608561038971, -0.1977471262216568, -0.32097166776657104, -0.1659584492444992, -0.2297000288963318, -0.27892249822616577, -0.33137840032577515, -0.2982378602027893, -0.12355726957321167, -0.16797995567321777, -0.163002610206604, -0.02413364127278328, -0.27999186515808105, -0.22871096432209015, -0.005093814805150032, -0.36884722113609314, -0.16624228656291962, -0.16189388930797577, -0.17784014344215393, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133504>
         [1.0014728307724, 0.5967382192611694, 1.0380908250808716, 1.2176114320755005, 0.44512739777565, 0.8625611066818237, 1.0530914068222046, 1.1910531520843506, 0.81491619348526, 1.0777709484100342, 1.1090294122695923, 0.5620336532592773, 1.1611664295196533, 1.2543836832046509, 1.0702707767486572, 1.200544834136963, 0.5499813556671143, 0.8348438143730164, 0.5559241771697998, 0.9717196226119995, 0.8950660228729248, 0.7388594746589661, 0.5258044004440308, 0.8351663947105408, 0.9210465550422668, 0.8118121027946472, 0.9593423008918762, 1.145887851715088, 0.5618463158607483, 0.7087838649749756, 1.0348899364471436, 0.538216233253479, 0.6593606472015381, 0.6939567923545837, ...]
       >
     },
     "decoder.up_blocks.1.resnets.2.norm2" => %{
       "beta" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133577>
         [-0.2823880612850189, -0.44302642345428467, -0.5542504191398621, -0.25225284695625305, -0.4170641303062439, -0.2889747619628906, -0.31910353899002075, -0.4495796263217926, -0.20969928801059723, -0.4099186956882477, -0.1733839511871338, -0.3964536488056183, -0.22347569465637207, -0.43633756041526794, -0.3678381145000458, -0.23742911219596863, -0.36614295840263367, -0.24926701188087463, -0.24438470602035522, -0.31617435812950134, -0.2368401437997818, -0.5970473885536194, -0.2556937336921692, -0.27721214294433594, -0.328208327293396, -0.511614978313446, -0.41586431860923767, -0.33516594767570496, -0.4509764015674591, -0.47624292969703674, -0.42769095301628113, -0.3205833435058594, -0.28521788120269775, -0.45960021018981934, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133578>
         [1.0586552619934082, 0.6881956458091736, 0.6817772388458252, 1.2113984823226929, 0.9640136361122131, 1.2200006246566772, 1.1260303258895874, 0.837802529335022, 1.2044378519058228, 1.1161799430847168, 1.3484894037246704, 1.1623547077178955, 1.2802072763442993, 0.9170098304748535, 1.055518388748169, 1.1579946279525757, 1.1301441192626953, 1.2490695714950562, 1.1743181943893433, 1.1647568941116333, 1.2834014892578125, 0.7968180179595947, 1.0533524751663208, 1.1565518379211426, 1.0986775159835815, 0.9228728413581848, 1.141667366027832, 1.1480270624160767, 1.195647954940796, 0.8610580563545227, 1.0551321506500244, 1.036010980606079, 0.9195089340209961, ...]
       >
     },
     "decoder.mid_block.attentions.0.group_norm" => %{
       "beta" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133517>
         [0.09007534384727478, 0.029610468074679375, 0.0561726838350296, 0.08703011274337769, -0.060135044157505035, 0.012975238263607025, -0.04209967330098152, 0.026651162654161453, 0.04964476823806763, -0.03203343600034714, -0.01756162941455841, -0.08134355396032333, -0.06643799692392349, -0.04995916783809662, -0.02400314062833786, 0.018715601414442062, 0.06835437566041946, -0.015063147060573101, -0.007110378239303827, 0.05643624812364578, -0.03534712642431259, 8.149505010806024e-4, -0.018912212923169136, -0.022207701578736305, 0.016037341207265854, -0.01753336377441883, 0.039056748151779175, 0.023585328832268715, -0.010852347128093243, 0.007619929034262896, 0.1259109526872635, -0.06683772057294846, 0.035869549959897995, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133518>
         [0.8365076184272766, 0.8694637417793274, 0.7892293930053711, 0.8730073571205139, 0.907859742641449, 0.7911950945854187, 0.8345701098442078, 0.8951919674873352, 0.8427298069000244, 0.9703206419944763, 0.9965815544128418, 0.8804466128349304, 0.6891328692436218, 0.8736458420753479, 0.8196414709091187, 0.8815308809280396, 0.785426676273346, 0.920810341835022, 0.7566802501678467, 0.7460156083106995, 0.8098206520080566, 0.9038854241371155, 0.8512054085731506, 0.7878472208976746, 0.843072235584259, 0.8654086589813232, 0.8084292411804199, 0.7496874928474426, 0.7802954912185669, 0.8431276082992554, 0.7710029482841492, 0.8982725143432617, ...]
       >
     },
     "decoder.up_blocks.1.resnets.0.conv2" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133591>
         [-0.02267337031662464, 0.0024073803797364235, 0.004772330168634653, 0.04532388225197792, -0.009831377305090427, 0.004764211364090443, 0.04541092365980148, -0.02975810319185257, 0.05230347812175751, 0.012532479129731655, 0.0214505847543478, 0.03400701284408569, -0.02460375800728798, 0.045974887907505035, 0.05797457695007324, 0.05403221398591995, -0.031592682003974915, -0.02572004497051239, -0.019790049642324448, -0.004865328781306744, 0.02952953614294529, 0.1413213163614273, 0.044080376625061035, 0.06390107423067093, 0.017300095409154892, 0.019015956670045853, 0.01816754788160324, 0.0010315155377611518, 0.014121279120445251, 0.03215339034795761, 0.010436530224978924, 0.01936863362789154, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][512][512]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132971>
         [
           [
             [
               [0.013670381158590317, -0.02297423966228962, 0.010045968927443027, -0.050134167075157166, -0.003924997989088297, 0.014582032337784767, -0.04438604786992073, -0.00550065515562892, 0.046004775911569595, 0.04552781209349632, -0.01847987249493599, 0.0024008823093026876, -0.011653442867100239, -0.017256321385502815, 0.05090852826833725, -0.05831305682659149, 0.06151521950960159, 0.07409629225730896, 0.03556783124804497, 0.03547250106930733, -0.021308533847332, -0.050799377262592316, 0.029933370649814606, -0.0013710358180105686, 0.0461466945707798, 0.041398871690034866, 0.022962026298046112, 0.019525259733200073, 0.03589199483394623, -0.01955837942659855, 0.04445403441786766, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.2.resnets.2.conv1" => %{
       "bias" => #Nx.Tensor<
         f32[256]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133551>
         [0.0029338488820940256, 0.007590205408632755, 0.013764441944658756, 0.045868292450904846, 0.021655486896634102, 0.019356966018676758, -0.011486592702567577, 0.0136624276638031, 0.05742296949028969, 0.02944291941821575, 0.012211336754262447, 0.03722136840224266, 0.03497808426618576, 0.04290897771716118, 0.006482461001724005, 0.008595832623541355, 0.011946344748139381, -0.030425049364566803, 0.007692087907344103, 0.06087034195661545, 0.0328914150595665, 0.01527349278330803, 0.005159521941095591, 0.05124053731560707, -0.008657832629978657, -0.012015129439532757, 0.005402229726314545, 0.00908186286687851, -0.00385906919836998, -0.04280167445540428, -0.03409527987241745, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][256][256]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132961>
         [
           [
             [
               [0.03529999777674675, -2.6741973124444485e-4, -0.07754883915185928, 0.002980026649311185, 0.041739415377378464, 0.040700528770685196, 0.05863763764500618, 0.043565504252910614, -0.01525427307933569, 0.025169622153043747, 0.08588691800832748, -3.887871207552962e-5, -0.005236202850937843, -0.014181504026055336, 0.03372529521584511, 0.00446719117462635, 0.020680489018559456, 0.0224892720580101, 0.019937751814723015, -0.009657679125666618, -0.03387152776122093, 0.05376089736819267, -0.034811001271009445, -0.05769405886530876, 0.11902540177106857, -0.0033049804624170065, -0.0030654380097985268, -0.019938012585043907, -0.025300659239292145, -0.046896792948246, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.mid_block.resnets.1.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133499>
         [-0.07643987983465195, -0.03609707951545715, -0.07570742070674896, -0.10854370146989822, -0.1448267102241516, -0.1345883458852768, -0.18311941623687744, -0.1252281367778778, -0.06093549355864525, -0.1234467402100563, -0.14031276106834412, -0.17987661063671112, -0.145022913813591, -0.13400977849960327, -0.1475125253200531, -0.10221263021230698, -0.18097272515296936, -0.10056139528751373, -0.13201884925365448, -0.1848081648349762, -0.11598265916109085, -0.1807803064584732, -0.12887543439865112, -0.12575259804725647, -0.18785199522972107, -0.1986173838376999, -0.10876592993736267, -0.21767160296440125, -0.182836651802063, -0.1250203400850296, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133500>
         [1.0856467485427856, 1.1576218605041504, 1.0926456451416016, 1.0069798231124878, 0.8652100563049316, 1.0943907499313354, 1.0772117376327515, 1.0841457843780518, 1.2202740907669067, 0.9064103960990906, 0.954684317111969, 0.8869320154190063, 0.9141423106193542, 1.0937862396240234, 1.031153678894043, 1.2223566770553589, 0.9752762317657471, 1.021097183227539, 1.099907398223877, 0.9529786109924316, 1.143915057182312, 0.930567741394043, 0.9993432760238647, 1.0364662408828735, 0.8795952796936035, 0.9240114092826843, 1.1315476894378662, 0.9997240304946899, 0.9084778428077698, ...]
       >
     },
     "decoder.up_blocks.1.resnets.2.conv2" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133575>
         [0.01300724595785141, -0.002747295657172799, 0.01852596178650856, -0.054633159190416336, 0.02205239050090313, 0.03315940126776695, -0.05036589130759239, 0.0033173484262079, -0.020503584295511246, 0.03504200279712677, -0.06016369163990021, 0.018565088510513306, 0.011386331170797348, -0.0360105000436306, -0.04735156521201134, -0.05383795499801636, -0.023355480283498764, 0.02991076000034809, 0.0296255461871624, 0.010717131197452545, -0.007230865303426981, -0.052705902606248856, -0.07311999797821045, -0.08673258870840073, 0.013530734926462173, -0.018555112183094025, -0.02593173086643219, -0.036709822714328766, 0.005872697103768587, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][512][512]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132958>
         [
           [
             [
               [-0.07045809924602509, 0.014290982857346535, -0.031834449619054794, -0.07700524479150772, 0.0791550949215889, -0.021621953696012497, 0.020109735429286957, 0.0055866967886686325, 0.008368364535272121, -0.0013135927729308605, 0.029632391408085823, -0.03629697859287262, 0.03646335005760193, 0.01595645397901535, -0.011514185927808285, -0.0384773313999176, 0.008406260050833225, -0.0225402619689703, 0.026443883776664734, 0.06397800892591476, -0.011776970699429512, -0.04500480741262436, 0.006754348985850811, -0.011254997923970222, 0.033835913985967636, 0.009629731997847557, 0.05032794922590256, 0.02813640423119068, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.2.resnets.2.conv2" => %{
       "bias" => #Nx.Tensor<
         f32[256]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133547>
         [0.04859129339456558, 0.022425895556807518, 0.04514523968100548, 0.008383320644497871, -0.01076440792530775, 0.03466978669166565, 0.01607353799045086, -0.028700795024633408, 0.025278838351368904, 0.0017754381988197565, -0.03468972444534302, 0.04688030853867531, 0.02534024976193905, 0.010754368267953396, 0.02404598891735077, 0.045415665954351425, 0.003077937988564372, 0.025702305138111115, 0.074025459587574, 0.05170338228344917, 0.009647342376410961, -0.008332893252372742, -0.009047821164131165, 0.024485241621732712, 0.032975491136312485, -0.02983737178146839, -0.03015178255736828, -0.057681918144226074, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][256][256]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132945>
         [
           [
             [
               [-0.039687931537628174, -0.016931815072894096, 0.0013833229895681143, -0.02421976625919342, -0.06948261708021164, 0.009401997551321983, -0.0031563336960971355, 0.060101307928562164, 0.007977452129125595, -0.04868418723344803, -0.05771736055612564, -0.056440263986587524, 0.11144910007715225, 0.03139885142445564, 0.03761574625968933, -0.017361778765916824, 0.008022823370993137, -0.004202474374324083, -0.04645516350865364, 0.0031643426045775414, -0.05840786546468735, 0.053806256502866745, -0.11002001166343689, -0.03971698880195618, 0.0014582669828087091, -0.0020155885722488165, 0.0018408586038276553, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.0.resnets.2.conv1" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133605>
         [0.019735392183065414, 0.01777764968574047, 0.017893465235829353, 0.002582993358373642, 0.002452889224514365, 0.011458841152489185, 0.025318576022982597, 0.025778863579034805, 0.025161538273096085, -0.0026088678278028965, -0.018989024683833122, 0.0013393063563853502, -0.030087506398558617, 0.006855659186840057, 0.004177695605903864, 0.005639032926410437, 0.042054031044244766, 0.031767696142196655, 0.023502172902226448, 0.03340469300746918, 0.0189045462757349, 0.015912897884845734, 0.03589547052979469, 0.04245168715715408, 0.022508375346660614, 0.055826328694820404, 0.05650653690099716, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][512][512]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132972>
         [
           [
             [
               [-0.059838369488716125, -0.028161874040961266, 0.028450826182961464, 0.05352463945746422, -0.02137358859181404, 0.026354510337114334, -0.0168510340154171, -0.01112617738544941, -0.051008936017751694, 0.032535191625356674, 0.06542296707630157, 0.012144817039370537, -0.20757411420345306, 0.018854748457670212, -0.01619013398885727, 0.0026873790193349123, 0.03432629257440567, -0.02853717841207981, 0.016120027750730515, 0.03421125188469887, 0.04294021800160408, 0.03704887628555298, -0.04948892816901207, 0.022248681634664536, 0.03808894008398056, -0.024465860798954964, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.0.resnets.2.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133607>
         [-0.15555520355701447, -0.23918811976909637, -0.09722926467657089, -0.15524378418922424, -0.1983826756477356, -0.22030428051948547, -0.2296798974275589, -0.1732112318277359, -0.2209332436323166, -0.1803571879863739, -0.19516338407993317, -0.176634281873703, -0.1798740178346634, -0.21575269103050232, -0.205496147274971, -0.12386715412139893, -0.16894137859344482, -0.16613076627254486, -0.1214548870921135, -0.11286855489015579, -0.17522861063480377, -0.1106170117855072, -0.16800183057785034, -0.1798039674758911, -0.15401142835617065, -0.1189054548740387, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133608>
         [1.1543974876403809, 1.0282624959945679, 1.1739082336425781, 1.1794570684432983, 0.8818044662475586, 0.9637389183044434, 1.0033862590789795, 1.0497328042984009, 1.134210228919983, 0.996073305606842, 0.9969602227210999, 1.067244291305542, 0.9491850137710571, 1.071164846420288, 0.9253490567207336, 1.104599952697754, 0.9743465781211853, 0.9876054525375366, 0.9883291125297546, 0.9657902121543884, 1.0721646547317505, 0.9990925192832947, 0.8569290041923523, 0.9949880242347717, 0.9338763356208801, ...]
       >
     },
     "decoder.mid_block.resnets.1.conv2" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133493>
         [-0.024306070059537888, 0.005852405913174152, -0.01462518610060215, 2.549906203057617e-4, 0.01686922274529934, 0.04700478911399841, -0.01977851800620556, 0.04426681995391846, 0.004184204153716564, 0.0531449094414711, 0.04786374792456627, -0.026380689814686775, 0.008312279358506203, 0.006775781512260437, 0.0092470059171319, 0.0010164129780605435, 0.008039511740207672, 0.042800672352313995, 0.015580911189317703, 0.027558274567127228, -0.014105845242738724, 0.033267829567193985, 0.05853477865457535, 0.029939942061901093, 0.06233218312263489, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][512][512]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132933>
         [
           [
             [
               [0.007972022518515587, -0.024753963574767113, -0.018086247146129608, 0.0038883702363818884, -0.021039532497525215, -0.04112749919295311, 0.010224546305835247, 0.00950630847364664, -0.00792631134390831, 0.052963852882385254, -0.012252897024154663, -0.023219294846057892, 0.0157460980117321, 0.02032799832522869, 0.0077112591825425625, -0.006285533774644136, -0.04236761853098869, -0.028320495039224625, 0.004132729489356279, -0.0033728815615177155, -0.005445216316729784, -0.02202368900179863, 0.0018496513366699219, 0.002730386797338724, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.0.upsamplers.0.conv" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133599>
         [-0.03134053945541382, -0.013957799412310123, 0.0099912378937006, 0.10513081401586533, 0.015912117436528206, -0.018743101507425308, 0.11333499103784561, -0.03322361782193184, 0.058689963072538376, 0.022559229284524918, 0.07015480846166611, 0.03753216564655304, -0.029311904683709145, 0.04047243669629097, 0.09139169752597809, 0.14367419481277466, 0.012626605108380318, -0.0708930566906929, -0.07102391123771667, 0.02682766318321228, 0.006008261349052191, -0.044835153967142105, 0.0852397158741951, 0.1086852103471756, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][512][512]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132973>
         [
           [
             [
               [0.021550409495830536, 0.033054836094379425, 0.005914896726608276, 0.025033840909600258, -0.03306930139660835, 0.010369660332798958, 0.012387438677251339, 0.009568617679178715, -0.018410373479127884, -0.010792276822030544, -0.015793338418006897, -0.014472957700490952, -0.030887683853507042, -0.030535491183400154, 0.03394883871078491, 0.010339802131056786, 0.012501629069447517, 0.05643302574753761, 0.016634242609143257, 0.0038546475116163492, -0.005337920971214771, 0.009888658300042152, 0.011824344284832478, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.1.resnets.2.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133581>
         [-0.12154114991426468, -0.13044530153274536, -0.1377847045660019, -0.25005075335502625, -0.16150230169296265, -0.14979195594787598, -0.30813300609588623, -0.24748240411281586, -0.21294564008712769, -0.17633382976055145, -0.22211633622646332, -0.29184117913246155, -0.15318605303764343, -0.2429099828004837, -0.23872661590576172, -0.2503078281879425, -0.22227950394153595, -0.2509770393371582, -0.23941154778003693, -0.246413454413414, -0.22666025161743164, -0.26611775159835815, -0.2784384787082672, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133582>
         [1.022894024848938, 1.0975373983383179, 0.8840048909187317, 0.8248741626739502, 1.0847890377044678, 1.0665881633758545, 0.8430882096290588, 0.9885262250900269, 0.9671209454536438, 1.0564216375350952, 0.8998017311096191, 0.7313052415847778, 0.9486103057861328, 0.8655090928077698, 0.8984904885292053, 0.829567551612854, 1.1005079746246338, 1.200619101524353, 1.1140812635421753, 1.2680425643920898, 0.9664458632469177, 0.8288095593452454, ...]
       >
     },
     "decoder.up_blocks.2.resnets.0.conv_shortcut" => %{
       "bias" => #Nx.Tensor<
         f32[256]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133563>
         [0.07596823573112488, 0.06884687393903732, -0.03505239263176918, 0.032151054590940475, 0.014354388229548931, 0.03630538284778595, -0.04414396733045578, 0.007776650134474039, 0.09388194978237152, 0.024211455136537552, 0.005319185554981232, 0.011220947839319706, 0.09801670163869858, -5.378269270295277e-5, -0.03347894549369812, 0.011887268163263798, -0.015990713611245155, 0.028503356501460075, 0.07484935224056244, -0.005277424119412899, 0.011935890652239323, 0.03970770910382271, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[1][1][512][256]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132969>
         [
           [
             [
               [0.016227860003709793, -0.02361324429512024, -0.0031472404953092337, 0.006225875578820705, 0.024584732949733734, 0.027015075087547302, -0.002973106922581792, 0.031871821731328964, -0.02372363768517971, 0.024159584194421768, 0.04351531341671944, 0.012830258347094059, -0.010931843891739845, 0.03451355919241905, 0.02092188596725464, 0.043341558426618576, 6.778797833248973e-4, -0.006813487038016319, 0.023886926472187042, 0.02846495993435383, -0.030355123803019524, ...],
               ...
             ]
           ]
         ]
       >
     },
     "decoder.up_blocks.3.resnets.1.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[128]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133533>
         [-0.03448871895670891, -0.00919732078909874, -0.08362723141908646, -0.10848936438560486, -0.11051121354103088, -0.04775077477097511, -0.00966720748692751, 0.007349735591560602, 0.0027313311584293842, -0.10646601766347885, -0.008889587596058846, -0.024372203275561333, -0.05120651051402092, -0.00805426575243473, -0.05918413773179054, -0.027913331985473633, -0.0691836029291153, -0.021161306649446487, -0.06853575259447098, -0.08046804368495941, -0.04373524338006973, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[128]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133534>
         [0.9627889394760132, 1.0067100524902344, 0.9927234649658203, 0.952272891998291, 0.8713177442550659, 0.9679545760154724, 0.9144411087036133, 0.9703196287155151, 0.8496143221855164, 0.891441285610199, 0.8324527740478516, 0.8498000502586365, 0.9588757157325745, 0.9785609245300293, 1.0110132694244385, 1.002758502960205, 0.9755114912986755, 0.9610609412193298, 0.9906319379806519, 0.9283066987991333, ...]
       >
     },
     "decoder.up_blocks.3.resnets.1.conv2" => %{
       "bias" => #Nx.Tensor<
         f32[128]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133527>
         [0.03935893625020981, -0.007481670472770929, 0.013177428394556046, -0.013329438865184784, -0.03127623349428177, 0.059876587241888046, 0.008181135170161724, -0.002966222818940878, -0.014444826170802116, 0.040089454501867294, -0.019551046192646027, 0.042907435446977615, -0.0037990575656294823, -0.020366471260786057, -0.006218914408236742, 0.03160744160413742, -0.023080255836248398, 0.01131113339215517, -0.0025703113060444593, 0.002744170604273677, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][128][128]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132941>
         [
           [
             [
               [0.016366740688681602, -0.014822622761130333, -0.09345366805791855, 0.0033102575689554214, -0.05290620028972626, -0.04110442101955414, -0.08182654529809952, -0.0023734865244477987, -0.05838538333773613, 0.008806335739791393, -0.04606492444872856, -0.07029107958078384, -0.010868070647120476, -0.004565463401377201, 0.01007054839283228, -0.03345796465873718, -0.06719116866588593, -0.05783623084425926, 0.029673613607883453, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.mid_block.attentions.0.query" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133515>
         [0.13209271430969238, 0.10029330849647522, -0.02270713821053505, 0.09697727859020233, -0.24667438864707947, 0.04664869233965874, -0.09780126065015793, -0.12455475330352783, -0.1398235559463501, -0.03363685682415962, 0.23399926722049713, 0.12012841552495956, -0.04219746217131615, 0.28482720255851746, 0.18274088203907013, 0.17012229561805725, -0.1012255847454071, 0.10981592535972595, -0.11720259487628937, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[512][512]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132944>
         [
           [0.03807162120938301, -0.006170645821839571, -0.05224720761179924, 0.018482007086277008, 0.024712683632969856, 0.05050284415483475, -0.04000130668282509, -0.04217079281806946, -0.08606220781803131, -0.009891029447317123, -0.04698943719267845, -0.011789443902671337, 0.03919880837202072, 0.03137659654021263, -0.007489787880331278, 1.8803041893988848e-4, -0.0016567560378462076, -0.033928193151950836, ...],
           ...
         ]
       >
     },
     "decoder.up_blocks.2.resnets.2.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[256]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133553>
         [-0.1321086585521698, -0.07226824015378952, -0.18869942426681519, -0.21338000893592834, -0.08784670382738113, -0.08910719305276871, -0.13830260932445526, -0.13094818592071533, -0.1556175947189331, -0.14177417755126953, -0.19822469353675842, -0.1311729997396469, -0.18367666006088257, -0.11849025636911392, -0.14889253675937653, -0.1665777713060379, -0.18578720092773438, -0.17120584845542908, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[256]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133554>
         [0.9337745308876038, 0.8365722894668579, 1.1145446300506592, 0.7800813317298889, 0.92067551612854, 1.0240978002548218, 1.0959124565124512, 1.0541001558303833, 0.924945592880249, 0.9185647964477539, 0.8666530847549438, 1.1496737003326416, 0.8632664680480957, 0.8619575500488281, 0.971161961555481, 0.850360631942749, 1.466611623764038, ...]
       >
     },
     "decoder.up_blocks.1.resnets.1.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133589>
         [-0.11672842502593994, -0.20761509239673615, -0.30735963582992554, -0.25108903646469116, -0.21273621916770935, -0.2218540608882904, -0.3224659264087677, -0.24570578336715698, -0.26636016368865967, -0.2380531132221222, -0.3037925958633423, -0.34227508306503296, -0.1875450760126114, -0.27407798171043396, -0.2736911177635193, -0.3121299743652344, -0.24687395989894867, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133590>
         [1.0707972049713135, 1.0477721691131592, 0.9270022511482239, 0.8385553956031799, 1.135200023651123, 1.0800825357437134, 0.7643186450004578, 1.0774166584014893, 0.9380769729614258, 1.015201449394226, 0.8376007080078125, 0.6870158314704895, 0.9053635001182556, 0.8431853652000427, 0.8349997401237488, 0.7602478265762329, ...]
       >
     },
     "decoder.up_blocks.0.resnets.1.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133615>
         [-0.30302631855010986, -0.23869577050209045, -0.16788016259670258, -0.329662561416626, -0.23950161039829254, -0.266197144985199, -0.2663394808769226, -0.2014235407114029, -0.16690126061439514, -0.22546720504760742, -0.22996371984481812, -0.18976987898349762, -0.17556557059288025, -0.20129549503326416, -0.28245481848716736, -0.22414977848529816, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133616>
         [1.2825133800506592, 1.2517039775848389, 1.209230899810791, 1.219826340675354, 0.8313745856285095, 0.9571352005004883, 1.0497257709503174, 1.0673538446426392, 1.1856244802474976, 1.0027602910995483, 1.0079530477523804, 0.9183741807937622, 0.9853500723838806, 1.2171837091445923, 0.8210490345954895, ...]
       >
     },
     "decoder.mid_block.resnets.1.norm2" => %{
       "beta" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133495>
         [-0.10175429284572601, -0.09342549741268158, -0.10159075260162354, -0.12229157984256744, -0.08042031526565552, -0.0849413126707077, -0.1374134123325348, -0.09863897413015366, -0.09704836457967758, -0.10255961865186691, -0.08481741696596146, 0.0809912234544754, -0.09059234708547592, -0.06304425001144409, -0.06643044203519821, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133496>
         [0.6988364458084106, 0.6668843030929565, 0.6679495573043823, 0.6976664066314697, 0.6382554173469543, 0.7081189751625061, 0.667679488658905, 0.675715446472168, 0.6574268341064453, 0.6732388138771057, 0.7076129913330078, 0.8760363459587097, 0.6726096868515015, 0.6354469656944275, ...]
       >
     },
     "decoder.conv_in" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133625>
         [0.10012295097112656, -0.15462109446525574, 0.011850619688630104, -0.07942363619804382, 0.0990838035941124, 0.028284192085266113, 0.15789161622524261, 0.07805365324020386, -0.09136280417442322, 0.016241205856204033, -0.028866514563560486, 0.11261909455060959, 0.14843139052391052, 0.20556806027889252, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][4][512]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132951>
         [
           [
             [
               [0.025696711614727974, 0.062450021505355835, -0.09122534841299057, -0.04807911813259125, -0.05162733793258667, 0.05719136446714401, 0.09825760126113892, -0.042968958616256714, 0.0544608049094677, -0.06710222363471985, -0.024661436676979065, 0.010462140664458275, 0.05867627635598183, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.2.upsamplers.0.conv" => %{
       "bias" => #Nx.Tensor<
         f32[256]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133545>
         [-0.05663676559925079, 4.136296338401735e-4, 0.012620276771485806, 0.0663147047162056, 0.06705399602651596, -0.020123010501265526, 0.08216322958469391, -0.08237433433532715, 0.003782999701797962, -0.0753636583685875, 0.04828739911317825, -0.0315389484167099, 0.011696039699018002, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][256][256]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132960>
         [
           [
             [
               [-0.002091828268021345, -0.018793020397424698, -0.044567178934812546, -0.04690728336572647, 0.0030410876497626305, 0.03773090988397598, 0.05912540480494499, -0.025569617748260498, -0.06019376590847969, 0.035449083894491196, 0.019115999341011047, 0.0012056005652993917, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.1.resnets.1.conv1" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133587>
         [0.018399057909846306, 0.008267927914857864, 0.022737618535757065, 0.06233332306146622, 0.013343213126063347, -0.0038127826992422342, 0.014000343158841133, 0.028073614463210106, 0.008567585609853268, 0.015812493860721588, 0.03288445621728897, 0.036263607442379, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][512][512]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132957>
         [
           [
             [
               [-0.0030732532031834126, -0.010477547533810139, 0.014787756837904453, -0.004483751952648163, -0.006784284953027964, -0.007774495054036379, 0.008616109378635883, 6.11045747064054e-4, 0.05065362527966499, -0.06601224094629288, 0.01227450929582119, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.2.resnets.0.norm1" => %{
       "beta" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133571>
         [-0.1255498230457306, -0.18644976615905762, -0.12108457833528519, -0.14124292135238647, -0.1993427276611328, -0.26161521673202515, -0.21042661368846893, -0.08831816166639328, -0.22866062819957733, -0.1757238507270813, -0.19601698219776154, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133572>
         [0.9120993614196777, 1.0477781295776367, 0.9248364567756653, 0.9585582613945007, 0.9554398059844971, 1.1485669612884521, 0.9649532437324524, 0.9259665012359619, 1.1280536651611328, 1.0412566661834717, ...]
       >
     },
     "decoder.mid_block.attentions.0.key" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133513>
         [-0.20796513557434082, -0.20413681864738464, -0.12072815746068954, 0.1205545961856842, -0.2035989612340927, 0.2660769522190094, 0.07188253849744797, -0.21139556169509888, 0.10163304209709167, -0.015418225899338722, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[512][512]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132946>
         [
           [-0.019659793004393578, 0.0073201716877520084, 0.02311955764889717, -0.004605315160006285, -0.027486693114042282, -0.030051065608859062, -0.034476809203624725, -0.09524613618850708, -0.010937260463833809, ...],
           ...
         ]
       >
     },
     "decoder.up_blocks.2.resnets.0.conv1" => %{
       "bias" => #Nx.Tensor<
         f32[256]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133569>
         [-0.0036684765946120024, 0.03490748256444931, 0.0182743351906538, 0.044514354318380356, -0.04795820638537407, 0.00830881018191576, 0.011143185198307037, 0.03618901968002319, 0.049187224358320236, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][512][256]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132976>
         [
           [
             [
               [0.008666932582855225, 0.0027991298120468855, -0.0185852088034153, -0.0034400264266878366, -0.009466650895774364, -0.022989528253674507, 0.041845545172691345, 0.039918914437294006, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.0.resnets.0.conv1" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133621>
         [0.01418408565223217, 0.023306215181946754, 0.02926742658019066, 0.0038017972838133574, 0.0032851940486580133, -4.251678183209151e-4, 0.029723607003688812, 0.019257845357060432, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][512][512]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132980>
         [
           [
             [
               [0.025127936154603958, 0.014690471813082695, -1.268249616259709e-4, 0.05694131180644035, 0.02758014388382435, 8.42756184283644e-4, 0.030048904940485954, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.mid_block.attentions.0.proj_attn" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133509>
         [0.01364346593618393, 0.007787159178406, 0.013599524274468422, 0.01607658341526985, 0.04268518462777138, 0.009255082346498966, -0.009840921498835087, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[512][512]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132970>
         [
           [-0.03343803808093071, 0.01604548655450344, 0.021079013124108315, -0.001895711524412036, 0.09892130643129349, -0.019935570657253265, ...],
           ...
         ]
       >
     },
     "decoder.up_blocks.1.resnets.0.norm2" => %{
       "beta" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133593>
         [-0.22593896090984344, -0.28661900758743286, -0.091656394302845, -0.1435796618461609, -0.3031977117061615, -0.26630163192749023, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133594>
         [0.9362268447875977, 0.8470934629440308, 1.1156061887741089, 1.0781184434890747, 0.78781658411026, ...]
       >
     },
     "decoder.up_blocks.1.upsamplers.0.conv" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133573>
         [-0.01811947301030159, 0.017699483782052994, 0.03955914452672005, 0.042928799986839294, 0.006100030615925789, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][512][512]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132965>
         [
           [
             [
               [0.004744811449199915, 0.005173230078071356, 0.02474021725356579, 0.04065006971359253, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.0.resnets.2.norm2" => %{
       "beta" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133603>
         [-0.19690188765525818, -0.1766243875026703, -0.15507198870182037, -0.13596829771995544, ...]
       >,
       "gamma" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133604>
         [0.7372363209724426, 0.748328447341919, 0.7502294182777405, ...]
       >
     },
     "decoder.up_blocks.2.resnets.1.conv1" => %{
       "bias" => #Nx.Tensor<
         f32[256]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133559>
         [4.14616777561605e-4, 0.022608814761042595, 0.05188325047492981, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][256][256]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132931>
         [
           [
             [
               [-0.01056826300919056, 0.02429646998643875, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.3.resnets.0.conv1" => %{
       "bias" => #Nx.Tensor<
         f32[128]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133541>
         [-0.0011187662603333592, 0.04416922107338905, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][256][128]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132949>
         [
           [
             [
               [-0.08688847720623016, ...],
               ...
             ],
             ...
           ],
           ...
         ]
       >
     },
     "decoder.up_blocks.3.resnets.1.conv1" => %{
       "bias" => #Nx.Tensor<
         f32[128]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133531>
         [0.021592898294329643, ...]
       >,
       "kernel" => #Nx.Tensor<
         f32[3][3][128][128]
         EXLA.Backend<host:0, 0.4102548783.2000027672.132954>
         [
           ...
         ]
       >
     },
     "decoder.up_blocks.1.resnets.2.conv1" => %{
       "bias" => #Nx.Tensor<
         f32[512]
         EXLA.Backend<host:0, 0.4102548783.2000027682.133579>
         [...]
       >,
       ...
     },
     "decoder.conv_out" => %{...},
     ...
   },
   spec: %Bumblebee.Diffusion.VaeKl{
     architecture: :decoder,
     sample_size: 512,
     in_channels: 3,
     out_channels: 3,
     latent_channels: 4,
     hidden_sizes: [128, 256, 512, 512],
     depth: 2,
     down_block_types: [:down_block, :down_block, :down_block, :down_block],
     up_block_types: [:up_block, :up_block, :up_block, :up_block],
     activation: :silu
   }
 }}
```

```elixir
prompt = Kino.Input.read(text_input)
seq_length = 60
batch_size = 2
num_steps = 20
guidance_scale = 7.5

tokenizer_options = [
  length: seq_length,
  return_token_type_ids: false,
  return_attention_mask: false
]

cond_tokens = Bumblebee.Text.ClipTokenizer.apply(tokenizer, prompt, tokenizer_options)
uncond_tokens = Bumblebee.Text.ClipTokenizer.apply(tokenizer, "", tokenizer_options)
# Since cond_tokens and uncond_tokens are maps, this concats the corresponding keys correctly
tokens = Bumblebee.Utils.Nx.composite_concatenate(uncond_tokens, cond_tokens)
%{hidden_state: text_embeddings} = Axon.predict(clip.model, clip.params, tokens, compiler: EXLA)
# Shape = {2, 60, 768}
text_embeddings
```

<!-- livebook:{"output":true} -->

```

01:06:36.251 [info] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero

01:06:36.251 [info] XLA service 0x7f44983c9aa0 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:

01:06:36.251 [info]   StreamExecutor device (0): NVIDIA GeForce RTX 3080, Compute Capability 8.6

01:06:36.251 [info] Using BFC allocator.

01:06:36.251 [info] XLA backend allocating 9248263372 bytes on device 0 for BFCAllocator.

01:06:40.260 [info] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.

```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  f32[2][60][768]
  EXLA.Backend<cuda:0, 0.4102548783.2000027682.133942>
  [
    [
      [-0.3883766233921051, 0.022943556308746338, -0.05219653248786926, -0.18406079709529877, -0.027318544685840607, -0.33554932475090027, -0.017579175531864166, -0.18692903220653534, 0.18770650029182434, -0.09066227823495865, -0.22801177203655243, -0.14969749748706818, -0.07411374896764755, -0.3546871542930603, 0.11344203352928162, -0.10165039449930191, -0.11977914720773697, -0.10019044578075409, 0.04471955448389053, -28.091182708740234, -0.14018775522708893, -0.1786779761314392, -0.0848737359046936, -0.09500151127576828, -0.08985760062932968, -0.10875239223241806, -0.18392188847064972, -0.18163573741912842, -0.31132182478904724, -0.041487231850624084, -0.009218327701091766, -0.04833769053220749, -0.11456298828125, -0.06755103170871735, -0.21423092484474182, -0.33372682332992554, -0.37395262718200684, -0.1396586000919342, -0.05301784723997116, 0.03968849778175354, -0.15527239441871643, -0.15999126434326172, -0.16294527053833008, -0.1899382621049881, -0.1639447659254074, -0.3056219220161438, 0.037788596004247665, -0.15302295982837677, -0.3526281714439392, -0.14358115196228027, ...],
      ...
    ],
    ...
  ]
>
```

We have the text embeddings for the conditional and unconditional prompt, but we need to replicate these to match our batch size. We're going to put our batch size in the *2nd* dimension so later we can easily split the output into the conditional and unconditional parts.

```elixir
text_embeddings =
  text_embeddings
  |> Nx.new_axis(1)
  |> Nx.tile([1, batch_size, 1, 1])
  |> Nx.reshape({:auto, seq_length, 768})
```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  f32[4][60][768]
  EXLA.Backend<cuda:0, 0.4102548783.2000027682.133949>
  [
    [
      [-0.3883766233921051, 0.022943556308746338, -0.05219653248786926, -0.18406079709529877, -0.027318544685840607, -0.33554932475090027, -0.017579175531864166, -0.18692903220653534, 0.18770650029182434, -0.09066227823495865, -0.22801177203655243, -0.14969749748706818, -0.07411374896764755, -0.3546871542930603, 0.11344203352928162, -0.10165039449930191, -0.11977914720773697, -0.10019044578075409, 0.04471955448389053, -28.091182708740234, -0.14018775522708893, -0.1786779761314392, -0.0848737359046936, -0.09500151127576828, -0.08985760062932968, -0.10875239223241806, -0.18392188847064972, -0.18163573741912842, -0.31132182478904724, -0.041487231850624084, -0.009218327701091766, -0.04833769053220749, -0.11456298828125, -0.06755103170871735, -0.21423092484474182, -0.33372682332992554, -0.37395262718200684, -0.1396586000919342, -0.05301784723997116, 0.03968849778175354, -0.15527239441871643, -0.15999126434326172, -0.16294527053833008, -0.1899382621049881, -0.1639447659254074, -0.3056219220161438, 0.037788596004247665, -0.15302295982837677, -0.3526281714439392, -0.14358115196228027, ...],
      ...
    ],
    ...
  ]
>
```

The final shape of `text_embeddings` is `{batch_size*2, 60, 768}` with the first batch of size batch_size being the embeddings for the empty prompt (unconditional) and the 2nd batch being the embeddings for our target prompt (conditional).

Next, we'll create our starting random latent vectors, one for each generation we're going to do. For this model, we can look at the spec to determine these are 64x64x4 tensors. So our final output is going to have shape `{batch_size, 64, 64, 4}`, one latent for each image we're going to generate.

```elixir
latents_shape = {batch_size, unet.spec.sample_size, unet.spec.sample_size, unet.spec.in_channels}
key = Nx.Random.key(0)
{latents, _new_key} = Nx.Random.normal(key, shape: latents_shape)
latents
```

<!-- livebook:{"output":true} -->

```
#Nx.Tensor<
  f32[2][64][64][4]
  EXLA.Backend<host:0, 0.4102548783.2000027672.133552>
  [
    [
      [
        [0.45112332701683044, -0.5001975297927856, 2.183396100997925, -0.38485145568847656],
        [0.4643142819404602, 0.7787218689918518, 0.4496215581893921, 0.9963446259498596],
        [-0.5302942395210266, -0.7561089992523193, -1.0312230587005615, -0.15097050368785858],
        [1.4000201225280762, 0.7577996253967285, -0.7165606617927551, 0.39025259017944336],
        [-1.1662782430648804, -0.7743173241615295, -0.19642938673496246, -0.08238022774457932],
        [-0.06646038591861725, -1.8902148008346558, -1.1872320175170898, 0.9894598126411438],
        [-0.3402213752269745, -0.7232538461685181, 1.8787921667099, 0.2767496407032013],
        [-0.49341899156570435, -0.5502104759216309, -1.0548129081726074, 0.35017716884613037],
        [0.9882685542106628, 0.5080770254135132, -0.46752429008483887, 0.5117209553718567],
        [-0.8843454122543335, -1.8525041341781616, -1.0225008726119995, 0.025432130321860313],
        [-0.948764979839325, -0.5162801146507263, -1.1592198610305786, -0.18225179612636566],
        [-0.5101140737533569, -0.9591039419174194, -0.7398084998130798, -1.6396390199661255],
        [-0.08064944297075272, -0.6787317991256714, ...],
        ...
      ],
      ...
    ],
    ...
  ]
>
```

Now we have all the pieces, we can do a single step of our eventual loop. We'll initialize the scheduler and then predict the in our current (totally noisy) latents. We can even try to visualize our outputs - though don't expect much... yet.

```elixir
{:ok, scheduler} = Bumblebee.load_scheduler({:hf, repository_id, subdir: "scheduler"})
```

<!-- livebook:{"output":true} -->

```
{:ok,
 %Bumblebee.Diffusion.PndmScheduler{
   num_train_steps: 1000,
   beta_schedule: :quadratic,
   beta_start: 8.5e-4,
   beta_end: 0.012,
   alpha_clip_strategy: :alpha_zero,
   timesteps_offset: 1,
   reduce_warmup: true
 }}
```

```elixir
defmodule SDHelper do
  import Nx.Defn

  # We need this in a module so we can use use `Nx.Defn` so the operators work
  defn apply_guidance(noise_pred_uncond, noise_pred_cond, guidance_scale) do
    noise_pred_uncond + guidance_scale * (noise_pred_cond - noise_pred_uncond)
  end

  # TODO: remove this once https://github.com/elixir-nx/bumblebee/issues/123 lands in main
  defn scheduler_step(step_fn, scheduler_state, latents, noise_pred) do
    step_fn.(scheduler_state, latents, noise_pred)
  end
end
```

<!-- livebook:{"output":true} -->

```
{:module, SDHelper, <<70, 79, 82, 49, 0, 0, 12, ...>>, {:scheduler_step, 4}}
```

```elixir
{scheduler_state, timesteps} = Bumblebee.scheduler_init(scheduler, num_steps, latents_shape)

scheduler_step_fn = &Bumblebee.scheduler_step(scheduler, &1, &2, &3)
```

<!-- livebook:{"output":true} -->

```
#Function<40.3316493/3 in :erl_eval.expr/6>
```

Now that we have our new latents after one step of the diffusion process, we can run them through the VAE to see what the image looks like. But we're not expecting much since it's just a single step.

<!-- livebook:{"break_markdown":true} -->

It's a noisy mess but that's what we expected. Let's put this into a loop and run all 20 steps so we can get a real image. We'll use a `while` loop in `defn` for a performance gain. To do that, we'll have to use the pre-built versions of our models to avoid issues passing them into the `defn`

```elixir
{_, unet_predict} = Axon.build(unet.model, compiler: EXLA, client: :cuda, lazy_transfers: :always)
{_, vae_predict} = Axon.build(vae.model, compiler: EXLA, client: :cuda, lazy_transfers: :always)

defmodule SDLoop do
  import Nx.Defn

  defn run(
         guidance_scale,
         latents,
         timesteps,
         text_embeddings,
         unet_predict,
         unet_params,
         scheduler_step_fn,
         scheduler_state
       ) do
    {scheduler_state, latents, _, _, _} =
      while {scheduler_state, latents, unet_params, text_embeddings, guidance_scale},
            timestep <- timesteps do
        unet_inputs = %{
          "sample" => Nx.concatenate([latents, latents]),
          "timestep" => timestep,
          "encoder_hidden_state" => text_embeddings
        }

        %{sample: noise_pred} = unet_predict.(unet_params, unet_inputs, compiler: EXLA)

        batch_size = div(Nx.axis_size(noise_pred, 0), 2)
        noise_pred_uncond = noise_pred[0..(batch_size - 1)]
        noise_pred_cond = noise_pred[batch_size..-1//1]
        noise_pred = SDHelper.apply_guidance(noise_pred_uncond, noise_pred_cond, guidance_scale)

        {scheduler_state, latents} =
          SDHelper.scheduler_step(scheduler_step_fn, scheduler_state, latents, noise_pred)

        {scheduler_state, latents, unet_params, text_embeddings, guidance_scale}
      end

    {scheduler_state, latents}
  end
end

# {_final_scheduler_state, final_latents} =
#   SDLoop.run(
#     guidance_scale,
#     latents,
#     timesteps,
#     text_embeddings,
#     unet_predict,
#     unet.params,
#     scheduler_step_fn,
#     scheduler_state
#   )
```

<!-- livebook:{"output":true} -->

```
{:module, SDLoop, <<70, 79, 82, 49, 0, 0, 18, ...>>, {:run, 8}}
```

Now `final_latents` represents the latents for our image after many steps of the diffusion denoising process. Let's run them through the VAE to see what they look like.

<!-- livebook:{"break_markdown":true} -->

Success! It matches our original generation using `Bumblebee` and `Nx.Serving` because we used the same seed of 0.

The advantage of breaking the model down like this is now we can use the additional control to add features. Let's do that now.

## Using our controllable SD inference

It requires too much patience to wait while the image is being generated. Let's make it so we can see the intermediate results as they're generated.

```elixir
frame = Kino.Frame.new() |> Kino.render()

defmodule SDRenderer do
  def render_latents(latents, vae) do
    latents = Nx.multiply(latents, 1 / 0.18215)
    %{sample: image} = Axon.predict(vae.model, vae.params, latents, compiler: EXLA)
    images = NxImage.from_continuous(image, -1, 1)
    Enum.map(0..(Nx.axis_size(images, 0) - 1), &Kino.Image.new(images[&1]))
  end

  def render_latents(latents, vae, frame) do
    kino_images = render_latents(latents, vae)
    image_grid = Kino.Layout.grid(kino_images, boxed: true, columns: 2)
    Kino.Frame.render(frame, image_grid)
  end
end

chunked_timesteps =
  timesteps
  |> Nx.to_flat_list()
  |> Enum.chunk_every(4)
  |> Enum.map(&Nx.tensor/1)

{_, final_latents} =
  Enum.reduce(chunked_timesteps, {scheduler_state, latents}, fn timesteps,
                                                                {scheduler_state, latents} ->
    {scheduler_state, latents} =
      SDLoop.run(
        guidance_scale,
        latents,
        timesteps,
        text_embeddings,
        unet_predict,
        unet.params,
        scheduler_step_fn,
        scheduler_state
      )

    SDRenderer.render_latents(latents, vae, frame)
    {scheduler_state, latents}
  end)
```
